<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>PIMOU ‚Äî Weight Loss Tracker</title>
<!-- PIMOU_BUILD_v9 -->
<meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="pragma" content="no-cache">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  /* Force Poppins with multiple fallbacks */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap');
  
  html, body, * {
    font-family: 'Poppins', -apple-system, 'Segoe UI', Roboto, sans-serif !important;
  }
  :root {
    --green-900: #1a3a2a;
    --green-800: #1e4d35;
    --green-700: #1b5e42;
    --green-600: #2d7a56;
    --green-500: #3a9668;
    --green-400: #52b07e;
    --green-300: #7ecba0;
    --green-200: #b2e0c8;
    --green-100: #e0f4ec;
    --green-50:  #f2fbf6;
    --accent:    #00e676;
    --warn:      #ff6b6b;
    --warn-soft: #fff0f0;
    --gold:      #ffc947;
    --text-dark: #0f1f18;
    --text-mid:  #3a5a48;
    --text-soft: #7aa08a;
    --bg:        #f4faf7;
    --card:      #ffffff;
    --border:    #d4eddf;
    --shadow:    0 4px 24px rgba(27,94,66,0.10);
    --shadow-lg: 0 12px 40px rgba(27,94,66,0.18);
  }

  * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

  body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg);
    color: var(--text-dark);
    min-height: 100vh;
    max-width: 430px;
    margin: 0 auto;
    overflow-x: hidden;
  }

  /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
  .screen { display:none; min-height:100vh; flex-direction:column; }
  .screen.active { display:flex; }

  /* ‚îÄ‚îÄ ONBOARDING ‚îÄ‚îÄ */
  #screen-welcome {
    background: linear-gradient(160deg, var(--green-900) 0%, var(--green-700) 55%, var(--green-500) 100%);
    align-items: center;
    justify-content: center;
    padding: 40px 32px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  #screen-welcome::before {
    content: '';
    position: absolute;
    width: 300px; height: 300px;
    border-radius: 50%;
    background: rgba(255,255,255,0.04);
    top: -80px; right: -80px;
  }
  #screen-welcome::after {
    content: '';
    position: absolute;
    width: 200px; height: 200px;
    border-radius: 50%;
    background: rgba(0,230,118,0.08);
    bottom: 60px; left: -60px;
  }
  .welcome-logo {
    width: 80px; height: 80px;
    background: rgba(255,255,255,0.12);
    border-radius: 24px;
    display: flex; align-items: center; justify-content: center;
    font-size: 36px;
    margin: 0 auto 28px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.15);
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  }
  .welcome-title {
    font-size: 42px; font-weight: 800;
    color: #fff;
    letter-spacing: -1px;
    line-height: 1;
    margin-bottom: 8px;
  }
  .welcome-sub {
    font-size: 13px; font-weight: 400;
    color: rgba(255,255,255,0.6);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 32px;
  }
  .welcome-desc {
    font-size: 15px; color: rgba(255,255,255,0.75);
    line-height: 1.7;
    margin-bottom: 48px;
  }

  /* ‚îÄ‚îÄ ONBOARDING STEPS ‚îÄ‚îÄ */
  #screen-onboard {
    background: var(--bg);
    padding: 0;
  }
  .onboard-header {
    background: linear-gradient(135deg, var(--green-900), var(--green-700));
    padding: 56px 28px 32px;
    position: relative;
    overflow: hidden;
  }
  .onboard-header::after {
    content: '';
    position: absolute;
    width: 150px; height: 150px;
    border-radius: 50%;
    background: rgba(255,255,255,0.05);
    bottom: -40px; right: -20px;
  }
  .step-label {
    font-size: 11px; font-weight: 600;
    color: var(--green-300);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 8px;
  }
  .onboard-title {
    font-size: 26px; font-weight: 700;
    color: #fff;
    line-height: 1.25;
  }
  .progress-dots {
    display: flex; gap: 6px;
    margin-top: 20px;
  }
  .dot {
    height: 4px; border-radius: 2px;
    background: rgba(255,255,255,0.25);
    transition: all 0.3s;
  }
  .dot.active { background: var(--accent); width: 24px !important; }
  .dot.done { background: rgba(255,255,255,0.5); }

  .onboard-body { padding: 28px 24px; flex: 1; overflow-y: auto; }

  /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
  .field-group { margin-bottom: 20px; }
  .field-label {
    font-size: 12px; font-weight: 600;
    color: var(--text-soft);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 8px;
    display: block;
  }
  .field-input {
    width: 100%;
    padding: 14px 16px;
    border: 1.5px solid var(--border);
    border-radius: 14px;
    font-family: 'Poppins', sans-serif;
    font-size: 15px;
    color: var(--text-dark);
    background: var(--card);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
  }
  .field-input:focus {
    border-color: var(--green-500);
    box-shadow: 0 0 0 3px rgba(58,150,104,0.12);
  }
  .field-hint {
    font-size: 11px; color: var(--text-soft);
    margin-top: 5px;
  }
  .field-row { display: flex; gap: 12px; }
  .field-row .field-group { flex: 1; }

  .toggle-group { display: flex; gap: 8px; }
  .toggle-btn {
    flex: 1; padding: 12px 8px;
    border: 1.5px solid var(--border);
    border-radius: 12px;
    background: var(--card);
    font-family: 'Poppins', sans-serif;
    font-size: 14px; font-weight: 500;
    color: var(--text-mid);
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
  }
  .toggle-btn.active {
    background: var(--green-900);
    border-color: var(--green-900);
    color: #fff;
  }

  .checkbox-item {
    display: flex; align-items: center; gap: 12px;
    padding: 12px 14px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .checkbox-item.checked {
    border-color: var(--green-500);
    background: var(--green-50);
  }
  .checkbox-box {
    width: 20px; height: 20px;
    border-radius: 6px;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 11px;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .checkbox-item.checked .checkbox-box {
    background: var(--green-700);
    border-color: var(--green-700);
    color: #fff;
  }
  .checkbox-label { font-size: 14px; font-weight: 500; }

  .calc-result {
    background: linear-gradient(135deg, var(--green-900), var(--green-700));
    border-radius: 18px;
    padding: 20px;
    margin: 16px 0;
    color: #fff;
  }
  .calc-row { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; }
  .calc-label { font-size: 12px; color: rgba(255,255,255,0.65); }
  .calc-value { font-size: 16px; font-weight: 700; }
  .calc-value.accent { color: var(--accent); }
  .calc-divider { border: none; border-top: 1px solid rgba(255,255,255,0.12); margin: 8px 0; }

  /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
  .btn-primary {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--green-700), var(--green-900));
    color: #fff;
    border: none;
    border-radius: 16px;
    font-family: 'Poppins', sans-serif;
    font-size: 16px; font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 6px 20px rgba(27,94,66,0.35);
  }
  .btn-primary:active { transform: scale(0.98); }
  .btn-secondary {
    width: 100%;
    padding: 14px;
    background: transparent;
    color: var(--text-soft);
    border: 1.5px solid var(--border);
    border-radius: 16px;
    font-family: 'Poppins', sans-serif;
    font-size: 14px; font-weight: 500;
    cursor: pointer;
    margin-top: 10px;
  }

  /* ‚îÄ‚îÄ MAIN APP LAYOUT ‚îÄ‚îÄ */
  #screen-app { background: var(--bg); padding-bottom: 80px; }

  /* TOP BAR */
  .topbar {
    background: linear-gradient(135deg, var(--green-900) 0%, var(--green-700) 100%);
    padding: 52px 24px 28px;
    position: relative;
    overflow: hidden;
  }
  .topbar::before {
    content: '';
    position: absolute;
    width: 200px; height: 200px;
    border-radius: 50%;
    background: rgba(255,255,255,0.04);
    top: -60px; right: -40px;
  }
  .topbar-row { display: flex; justify-content: space-between; align-items: flex-start; }
  .topbar-greeting { font-size: 13px; color: rgba(255,255,255,0.6); margin-bottom: 2px; }
  .topbar-name { font-size: 22px; font-weight: 700; color: #fff; }
  .topbar-avatar {
    width: 44px; height: 44px;
    background: rgba(255,255,255,0.15);
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    border: 1px solid rgba(255,255,255,0.2);
  }

  /* GOAL CARD in topbar */
  .goal-bar-wrap { margin-top: 20px; }
  .goal-bar-label { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .goal-bar-label span { font-size: 12px; color: rgba(255,255,255,0.65); }
  .goal-bar-label strong { font-size: 12px; color: #fff; }
  .goal-bar-track {
    height: 6px;
    background: rgba(255,255,255,0.15);
    border-radius: 3px;
    overflow: hidden;
  }
  .goal-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), #00c853);
    border-radius: 3px;
    transition: width 1s ease;
  }
  .goal-tags { display: flex; gap: 8px; margin-top: 14px; }
  .goal-tag {
    padding: 4px 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    font-size: 11px; color: rgba(255,255,255,0.75);
    border: 1px solid rgba(255,255,255,0.12);
  }

  /* CONTENT SCROLL */
  .content { padding: 20px 20px; }

  /* SECTION TITLE */
  .section-title {
    font-size: 13px; font-weight: 700;
    color: var(--text-soft);
    letter-spacing: 1.5px;
    text-transform: uppercase;
    margin-bottom: 14px;
    margin-top: 24px;
  }
  .section-title:first-child { margin-top: 0; }

  /* TODAY CHECKLIST */
  .checklist-wrap { display: flex; flex-direction: column; gap: 8px; }
  .check-item {
    display: flex; align-items: center; gap: 14px;
    background: var(--card);
    border-radius: 16px;
    padding: 14px 16px;
    border: 1.5px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
  }
  .check-item.done {
    border-color: var(--green-200);
    background: var(--green-50);
  }
  .check-circle {
    width: 28px; height: 28px;
    border-radius: 50%;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    font-size: 13px;
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .check-item.done .check-circle {
    background: var(--green-700);
    border-color: var(--green-700);
    color: #fff;
  }
  .check-info { flex: 1; }
  .check-name { font-size: 14px; font-weight: 600; color: var(--text-dark); }
  .check-time { font-size: 11px; color: var(--text-soft); margin-top: 1px; }
  .check-item.done .check-name { color: var(--text-soft); text-decoration: line-through; }

  /* STAT CARDS */
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .stat-card {
    background: var(--card);
    border-radius: 18px;
    padding: 18px 16px;
    border: 1.5px solid var(--border);
    position: relative;
    overflow: hidden;
  }
  .stat-card::after {
    content: '';
    position: absolute;
    width: 60px; height: 60px;
    border-radius: 50%;
    background: var(--green-100);
    right: -15px; bottom: -15px;
  }
  .stat-icon { font-size: 20px; margin-bottom: 8px; }
  .stat-label { font-size: 11px; color: var(--text-soft); font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
  .stat-value { font-size: 24px; font-weight: 800; color: var(--text-dark); line-height: 1.1; }
  .stat-unit { font-size: 12px; color: var(--text-soft); font-weight: 400; }
  .stat-delta {
    font-size: 11px; font-weight: 600;
    margin-top: 4px;
    display: inline-block;
    padding: 2px 8px;
    border-radius: 20px;
  }
  .stat-delta.down { background: var(--green-100); color: var(--green-700); }
  .stat-delta.up { background: var(--warn-soft); color: var(--warn); }
  .stat-delta.ok { background: var(--green-100); color: var(--green-700); }

  /* BP CARD */
  .bp-card {
    background: var(--card);
    border-radius: 18px;
    padding: 18px;
    border: 1.5px solid var(--border);
    margin-bottom: 12px;
  }
  .bp-card-title { font-size: 13px; font-weight: 600; color: var(--text-mid); margin-bottom: 14px; }
  .bp-readings { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .bp-reading {
    background: var(--bg);
    border-radius: 12px;
    padding: 12px;
    text-align: center;
    border: 1px solid var(--border);
  }
  .bp-reading-label { font-size: 10px; color: var(--text-soft); text-transform: uppercase; letter-spacing: 0.5px; }
  .bp-reading-val { font-size: 20px; font-weight: 800; color: var(--text-dark); }
  .bp-reading-val.warn { color: var(--warn); }
  .bp-reading-sub { font-size: 10px; color: var(--text-soft); }

  /* MINI CHART */
  .chart-card {
    background: var(--card);
    border-radius: 18px;
    padding: 18px;
    border: 1.5px solid var(--border);
  }
  .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
  .chart-title { font-size: 14px; font-weight: 700; color: var(--text-dark); }
  .chart-tabs { display: flex; gap: 4px; }
  .chart-tab {
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 11px; font-weight: 600;
    cursor: pointer;
    color: var(--text-soft);
    background: transparent;
    border: none;
    font-family: 'Poppins', sans-serif;
  }
  .chart-tab.active { background: var(--green-900); color: #fff; }
  canvas { max-width: 100%; }

  /* WEEKLY PLAN */
  .week-scroll { overflow-x: auto; padding-bottom: 4px; }
  .week-scroll::-webkit-scrollbar { display: none; }
  .week-days { display: flex; gap: 10px; width: max-content; padding: 2px 0; }
  .day-card {
    width: 76px;
    background: var(--card);
    border-radius: 16px;
    padding: 14px 10px;
    text-align: center;
    border: 1.5px solid var(--border);
    flex-shrink: 0;
    transition: all 0.2s;
  }
  .day-card.today {
    background: linear-gradient(135deg, var(--green-900), var(--green-700));
    border-color: var(--green-700);
  }
  .day-card.today .day-name,
  .day-card.today .day-activity { color: rgba(255,255,255,0.7); }
  .day-card.today .day-num { color: #fff; }
  .day-name { font-size: 10px; font-weight: 600; text-transform: uppercase; color: var(--text-soft); letter-spacing: 0.5px; }
  .day-num { font-size: 20px; font-weight: 800; color: var(--text-dark); margin: 4px 0; }
  .day-icons { display: flex; gap: 3px; justify-content: center; flex-wrap: wrap; margin: 4px 0; }
  .day-icon { font-size: 11px; }
  .day-activity { font-size: 9px; color: var(--text-soft); line-height: 1.3; }
  .day-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--accent);
    margin: 4px auto 0;
  }

  /* BOTTOM NAV */
  .bottom-nav {
    position: fixed;
    bottom: 0; left: 50%;
    transform: translateX(-50%);
    width: 100%; max-width: 430px;
    background: rgba(255,255,255,0.96);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: flex;
    padding: 10px 8px 20px;
    z-index: 100;
  }
  .nav-item {
    flex: 1;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 3px;
    cursor: pointer;
    padding: 6px 4px;
    border-radius: 12px;
    transition: all 0.2s;
  }
  .nav-item.active { background: var(--green-50); }
  .nav-icon { font-size: 20px; }
  .nav-label { font-size: 10px; font-weight: 600; color: var(--text-soft); }
  .nav-item.active .nav-label { color: var(--green-700); }

  /* LOG TAB */
  .log-section { display: none; }
  .log-section.active { display: block; }

  .log-tabs { display: flex; gap: 6px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 4px; }
  .log-tabs::-webkit-scrollbar { display: none; }
  .log-tab {
    padding: 8px 16px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 20px;
    font-family: 'Poppins', sans-serif;
    font-size: 13px; font-weight: 600;
    color: var(--text-soft);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
  }
  .log-tab.active {
    background: var(--green-900);
    border-color: var(--green-900);
    color: #fff;
  }

  /* FOOD LOG */
  .meal-block {
    background: var(--card);
    border-radius: 18px;
    border: 1.5px solid var(--border);
    margin-bottom: 12px;
    overflow: hidden;
  }
  .meal-header {
    padding: 14px 16px;
    display: flex; align-items: center; gap: 10px;
    border-bottom: 1px solid var(--border);
  }
  .meal-icon { font-size: 20px; }
  .meal-title { font-size: 14px; font-weight: 700; flex: 1; }
  .meal-cal { font-size: 13px; font-weight: 700; color: var(--green-600); }
  .meal-items { padding: 8px 16px; }
  .meal-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); }
  .meal-item:last-child { border: none; }
  .meal-item-name { font-size: 13px; }
  .meal-item-cal { font-size: 12px; color: var(--text-soft); font-weight: 600; }
  .add-food-btn {
    display: flex; align-items: center; gap: 8px;
    padding: 12px 16px;
    color: var(--green-600);
    font-size: 13px; font-weight: 600;
    cursor: pointer;
    border: none; background: none;
    font-family: 'Poppins', sans-serif;
    width: 100%;
  }

  /* CAL SUMMARY BAR */
  .cal-summary {
    background: linear-gradient(135deg, var(--green-900), var(--green-700));
    border-radius: 18px;
    padding: 18px;
    margin-bottom: 16px;
    color: #fff;
  }
  .cal-row { display: flex; justify-content: space-between; margin-bottom: 12px; }
  .cal-item { text-align: center; }
  .cal-item-val { font-size: 22px; font-weight: 800; }
  .cal-item-label { font-size: 10px; color: rgba(255,255,255,0.6); text-transform: uppercase; letter-spacing: 0.5px; }
  .cal-track { height: 8px; background: rgba(255,255,255,0.15); border-radius: 4px; overflow: hidden; }
  .cal-fill { height: 100%; background: var(--accent); border-radius: 4px; transition: width 0.5s; }
  .cal-fill.over { background: var(--warn); }

  /* BP LOG */
  .bp-time-block {
    background: var(--card);
    border-radius: 18px;
    border: 1.5px solid var(--border);
    margin-bottom: 12px;
    overflow: hidden;
  }
  .bp-time-header {
    padding: 14px 16px;
    background: var(--green-50);
    border-bottom: 1px solid var(--border);
    font-size: 13px; font-weight: 700; color: var(--green-700);
    display: flex; align-items: center; gap: 8px;
  }
  .bp-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; padding: 16px; }
  .bp-input-group { text-align: center; }
  .bp-input-label { font-size: 10px; color: var(--text-soft); text-transform: uppercase; margin-bottom: 6px; letter-spacing: 0.5px; }
  .bp-input-field {
    width: 100%; padding: 10px 6px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    text-align: center;
    font-family: 'Poppins', sans-serif;
    font-size: 18px; font-weight: 700;
    color: var(--text-dark);
    background: var(--bg);
    outline: none;
    -webkit-appearance: none;
  }
  .bp-input-field:focus { border-color: var(--green-500); }
  .bp-warn { font-size: 11px; color: var(--warn); padding: 0 16px 12px; display: none; }
  .bp-warn.show { display: block; }

  /* PROGRESS TAB */
  .progress-tabs { display: flex; gap: 6px; margin-bottom: 20px; }
  .progress-tab {
    flex: 1; padding: 10px 4px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    font-family: 'Poppins', sans-serif;
    font-size: 12px; font-weight: 600;
    color: var(--text-soft);
    cursor: pointer;
    text-align: center;
  }
  .progress-tab.active {
    background: var(--green-900);
    border-color: var(--green-900);
    color: #fff;
  }

  /* WEEKLY SUMMARY CARD */
  .week-summary {
    background: var(--card);
    border-radius: 18px;
    border: 1.5px solid var(--border);
    padding: 18px;
    margin-bottom: 12px;
  }
  .week-summary-title { font-size: 13px; font-weight: 700; color: var(--text-mid); margin-bottom: 14px; }
  .week-metric { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); }
  .week-metric:last-child { border: none; }
  .week-metric-label { font-size: 13px; color: var(--text-mid); }
  .week-metric-val { font-size: 14px; font-weight: 700; color: var(--text-dark); }
  .badge { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
  .badge-green { background: var(--green-100); color: var(--green-700); }
  .badge-warn { background: var(--warn-soft); color: var(--warn); }

  /* MODAL */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0;
    background: rgba(15,31,24,0.6);
    z-index: 200;
    align-items: flex-end;
    backdrop-filter: blur(4px);
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--card);
    border-radius: 28px 28px 0 0;
    padding: 24px 24px 40px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
  }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
  .modal-handle {
    width: 36px; height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 0 auto 20px;
  }
  .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 20px; }
  .quick-foods { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
  .quick-food {
    padding: 6px 12px;
    background: var(--green-50);
    border: 1px solid var(--green-200);
    border-radius: 20px;
    font-size: 12px; font-weight: 600;
    color: var(--green-700);
    cursor: pointer;
  }

  /* SETTINGS */
  .settings-section {
    background: var(--card);
    border-radius: 18px;
    border: 1.5px solid var(--border);
    overflow: hidden;
    margin-bottom: 16px;
  }
  .settings-row {
    display: flex; align-items: center; gap: 14px;
    padding: 16px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
  }
  .settings-row:last-child { border: none; }
  .settings-icon { font-size: 20px; width: 24px; text-align: center; }
  .settings-label { flex: 1; font-size: 14px; font-weight: 500; }
  .settings-value { font-size: 13px; color: var(--text-soft); }
  .settings-arrow { font-size: 12px; color: var(--text-soft); }

  /* UTILITY */
  .mt-12 { margin-top: 12px; }
  .mt-20 { margin-top: 20px; }
  .text-center { text-align: center; }
  .divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }

  .fade-in { animation: fadeIn 0.4s ease; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* NOTIFICATION TOAST */
  .toast {
    position: fixed; top: 60px; left: 50%; transform: translateX(-50%);
    background: var(--green-900); color: #fff;
    padding: 12px 20px; border-radius: 20px;
    font-size: 13px; font-weight: 600;
    z-index: 999;
    display: none;
    box-shadow: var(--shadow-lg);
    white-space: nowrap;
  }
  .toast.show { display: block; animation: toastIn 0.3s ease; }
  @keyframes toastIn { from { opacity:0; top:40px; } to { opacity:1; top:60px; } }


</style>
</head>
<body>

<!-- TOAST -->
<div class="toast" id="toast">‚úì Saved!</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: WELCOME
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen active" id="screen-welcome">
  <div style="position:absolute;top:52px;right:24px;">
    <button id="welcome-lang-btn" onclick="toggleLangWelcome()" style="
      padding:5px 14px;
      background:rgba(255,255,255,0.15);
      border:1px solid rgba(255,255,255,0.3);
      border-radius:20px;
      color:#fff;
      font-family:'Poppins',sans-serif;
      font-size:11px;font-weight:700;
      cursor:pointer;letter-spacing:0.5px;
    ">EN</button>
  </div>
  <div class="welcome-logo">üåø</div>
  <div class="welcome-title">PIMOU</div>
  <div class="welcome-sub">Health Tracker</div>
  <div class="welcome-desc" id="welcome-desc">
    ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô<br>‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢<br>‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
  </div>
  <button class="btn-primary" id="welcome-start-btn" onclick="goTo('screen-onboard'); setOnboardStep(1)">
    ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚Üí
  </button>
  <button class="btn-secondary" id="welcome-existing-btn" onclick="handleExistingUser()">
    ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
  </button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: ONBOARDING
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-onboard">
  <div class="onboard-header">
    <div class="step-label" id="onboard-step-label">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏à‡∏≤‡∏Å 4</div>
    <div class="onboard-title" id="onboard-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
    <div class="progress-dots" id="progress-dots">
      <div class="dot active" style="width:12px"></div>
      <div class="dot" style="width:12px"></div>
      <div class="dot" style="width:12px"></div>
      <div class="dot" style="width:12px"></div>
    </div>
  </div>

  <!-- Step 1: Personal Info -->
  <div class="onboard-body fade-in" id="step-1">
    <div class="field-group">
      <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
      <input class="field-input" type="text" id="inp-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô PIM" oninput="updateCalcs()">
    </div>
    <div class="field-group">
      <label class="field-label">‡πÄ‡∏û‡∏®</label>
      <div class="toggle-group">
        <button class="toggle-btn active" id="btn-female" onclick="setGender('female')">‚ôÄ ‡∏´‡∏ç‡∏¥‡∏á</button>
        <button class="toggle-btn" id="btn-male" onclick="setGender('male')">‚ôÇ ‡∏ä‡∏≤‡∏¢</button>
      </div>
    </div>
    <div class="field-row">
      <div class="field-group">
        <label class="field-label">‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)</label>
        <input class="field-input" type="number" id="inp-age" placeholder="32" oninput="updateCalcs()">
      </div>
      <div class="field-group">
        <label class="field-label">‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
        <input class="field-input" type="number" id="inp-height" placeholder="155" oninput="updateCalcs()">
      </div>
    </div>
    <div class="field-row">
      <div class="field-group">
        <label class="field-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
        <input class="field-input" type="number" id="inp-weight" placeholder="92" oninput="updateCalcs()">
      </div>
      <div class="field-group">
        <label class="field-label">Body Fat% <span style="font-size:10px;color:var(--text-soft)">(‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)</span></label>
        <input class="field-input" type="number" id="inp-bf" placeholder="‚Äî ‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ" oninput="updateCalcs()">
      </div>
    </div>
    <div class="field-group">
      <label class="field-label">‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß</label>
      <div class="checkbox-item" id="chk-bp" onclick="toggleCheck('chk-bp','hypertension')">
        <div class="checkbox-box checked" id="cb-bp">‚úì</div>
        <span class="checkbox-label">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á</span>
      </div>
      <div class="checkbox-item" id="chk-dm" onclick="toggleCheck('chk-dm','diabetes')">
        <div class="checkbox-box" id="cb-dm"></div>
        <span class="checkbox-label">ü©∫ ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô</span>
      </div>
      <div class="checkbox-item" id="chk-other" onclick="toggleCheck('chk-other','other')">
        <div class="checkbox-box" id="cb-other"></div>
        <span class="checkbox-label">üíä ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>
      </div>
    </div>
    <div class="field-group" id="field-meds">
      <label class="field-label">‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥</label>
      <input class="field-input" type="text" id="inp-meds" placeholder="‡πÄ‡∏ä‡πà‡∏ô Amlodipine 5mg ‡πÄ‡∏ä‡πâ‡∏≤">
    </div>
    <button class="btn-primary mt-20" onclick="nextStep(2)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
  </div>

  <!-- Step 2: Goal -->
  <div class="onboard-body fade-in" id="step-2" style="display:none">
    <div class="field-row">
      <div class="field-group">
        <label class="field-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (kg)</label>
        <input class="field-input" type="number" id="inp-goal-weight" placeholder="72" oninput="updateCalcs()">
      </div>
      <div class="field-group">
        <label class="field-label">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)</label>
        <input class="field-input" type="number" id="inp-months" placeholder="6" oninput="updateCalcs()">
      </div>
    </div>
    <div class="field-group">
      <label class="field-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏Å</label>
      <select class="field-input" id="inp-activity" onchange="updateCalcs()">
        <option value="1.2">ü™ë ‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏Ç‡∏¢‡∏±‡∏ö</option>
        <option value="1.375">üö∂ ‡πÄ‡∏î‡∏¥‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ö‡∏≤</option>
        <option value="1.55" selected>üèÉ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠</option>
        <option value="1.65">üí™ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</option>
        <option value="1.725">üî• ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å</option>
      </select>
    </div>

    <!-- Calc Result -->
    <div class="calc-result" id="calc-result">
      <div class="calc-row">
        <span class="calc-label">BMI</span>
        <span class="calc-value" id="calc-bmi">‚Äî</span>
      </div>
      <hr class="calc-divider">
      <div class="calc-row">
        <span class="calc-label">BMR (‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)</span>
        <span class="calc-value" id="calc-bmr">‚Äî kcal</span>
      </div>
      <div class="calc-row">
        <span class="calc-label">TDEE (‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)</span>
        <span class="calc-value" id="calc-tdee">‚Äî kcal</span>
      </div>
      <hr class="calc-divider">
      <div class="calc-row">
        <span class="calc-label">üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà/‡∏ß‡∏±‡∏ô</span>
        <span class="calc-value accent" id="calc-target">‚Äî kcal</span>
      </div>
      <div class="calc-row">
        <span class="calc-label">‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</span>
        <span class="calc-value" id="calc-loss-rate">‚Äî kg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</span>
      </div>
    </div>

    <div class="field-group">
      <label class="field-label">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢/‡∏ß‡∏±‡∏ô (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)</label>
      <input class="field-input" type="number" id="inp-cal-target" placeholder="1850">
      <div class="field-hint">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</div>
    </div>
    <button class="btn-primary mt-12" onclick="nextStep(3)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
    <button class="btn-secondary" onclick="nextStep(1)">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <!-- Step 3: Exercise Schedule -->
  <div class="onboard-body fade-in" id="step-3" style="display:none">
    <p style="font-size:13px;color:var(--text-soft);margin-bottom:16px;line-height:1.6">
      ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á
    </p>
    <div id="exercise-schedule">
      <!-- Days rendered by JS -->
    </div>
    <button class="btn-primary mt-20" onclick="nextStep(4)">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
    <button class="btn-secondary" onclick="nextStep(2)">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>

  <!-- Step 4: Line Notify -->
  <div class="onboard-body fade-in" id="step-4" style="display:none">
    <div class="field-group">
      <label class="field-label">Line Notify Token</label>
      <input class="field-input" type="text" id="inp-line-token" placeholder="‡∏ß‡∏≤‡∏á Token ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà">
      <div class="field-hint">
        ‡∏£‡∏±‡∏ö Token ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà <strong>notify.line.me</strong> ‚Üí Personal Access Tokens
      </div>
    </div>
    <div style="background:var(--green-50);border-radius:14px;padding:14px;margin-bottom:16px;">
      <div style="font-size:12px;font-weight:700;color:var(--green-700);margin-bottom:10px;">‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
      <div class="field-row">
        <div class="field-group">
          <label class="field-label">‡πÄ‡∏ä‡πâ‡∏≤ (‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô)</label>
          <input class="field-input" type="time" id="notif-morning" value="06:00">
        </div>
        <div class="field-group">
          <label class="field-label">‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (log ‡∏≠‡∏≤‡∏´‡∏≤‡∏£)</label>
          <input class="field-input" type="time" id="notif-noon" value="12:00">
        </div>
      </div>
      <div class="field-row">
        <div class="field-group">
          <label class="field-label">‡πÄ‡∏¢‡πá‡∏ô (‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô)</label>
          <input class="field-input" type="time" id="notif-evening" value="18:00">
        </div>
        <div class="field-group">
          <label class="field-label">‡∏Ñ‡πà‡∏≥ (‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô)</label>
          <input class="field-input" type="time" id="notif-night" value="21:00">
        </div>
      </div>
    </div>

    <div class="field-group">
      <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡∏ô Line</label>
      <input class="field-input" type="text" id="inp-line-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô PIM">
      <div class="field-hint">‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
    </div>

    <button class="btn-primary mt-12" onclick="finishOnboard()">üåø ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PIMOU!</button>
    <button class="btn-secondary" onclick="nextStep(3)">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCREEN: MAIN APP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="screen" id="screen-app">

  <!-- TOP BAR -->
  <div class="topbar" id="app-topbar">
    <div class="topbar-row">
      <div>
        <div class="topbar-greeting" id="app-greeting">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ üåø</div>
        <div class="topbar-name" id="app-name">Loading...</div>
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <button id="lang-btn" onclick="toggleLang()" style="
          padding:5px 12px;
          background:rgba(255,255,255,0.15);
          border:1px solid rgba(255,255,255,0.25);
          border-radius:20px;
          color:#fff;
          font-family:'Poppins',sans-serif;
          font-size:11px;font-weight:700;
          cursor:pointer;
          letter-spacing:0.5px;
        ">EN</button>
        <div class="topbar-avatar">üåø</div>
      </div>
    </div>
    <div class="goal-bar-wrap">
      <div class="goal-bar-label">
        <span id="bar-label-left">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
        <strong id="bar-label-right">0%</strong>
      </div>
      <div class="goal-bar-track">
        <div class="goal-bar-fill" id="goal-bar-fill" style="width:0%"></div>
      </div>
      <div class="goal-tags" id="goal-tags">
        <div class="goal-tag" id="tag-day">Day ‚Äî</div>
        <div class="goal-tag" id="tag-left">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å ‚Äî kg</div>
        <div class="goal-tag" id="tag-cal">‡πÄ‡∏õ‡πâ‡∏≤ ‚Äî kcal</div>
      </div>
    </div>
  </div>

  <!-- TABS CONTENT -->
  <div class="content">

    <!-- ‚îÄ‚îÄ HOME TAB ‚îÄ‚îÄ -->
    <div class="log-section active" id="tab-home">

      <!-- Today Checklist -->
      <div class="section-title">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°?</div>
      <div class="checklist-wrap" id="today-checklist"></div>

      <!-- Weekly Schedule -->
      <div class="section-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</div>
      <div class="week-scroll">
        <div class="week-days" id="week-days-home"></div>
      </div>

      <!-- Quick Stats -->
      <div class="section-title">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">‚öñÔ∏è</div>
          <div class="stat-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</div>
          <div class="stat-value"><span id="stat-weight">‚Äî</span><span class="stat-unit"> kg</span></div>
          <div class="stat-delta down" id="stat-weight-delta">‚Äî</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üî•</div>
          <div class="stat-label">Cal ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          <div class="stat-value"><span id="stat-cal">‚Äî</span><span class="stat-unit"> kcal</span></div>
          <div class="stat-delta ok" id="stat-cal-status">‚Äî</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">‚ù§Ô∏è</div>
          <div class="stat-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</div>
          <div class="stat-value"><span id="stat-bp">‚Äî/‚Äî</span></div>
          <div class="stat-delta ok" id="stat-bp-status">‚Äî</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üìè</div>
          <div class="stat-label">BMI</div>
          <div class="stat-value"><span id="stat-bmi">‚Äî</span></div>
          <div class="stat-delta ok" id="stat-bmi-cat">‚Äî</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üëü</div>
          <div class="stat-label">‡∏Å‡πâ‡∏≤‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
          <div class="stat-value" id="stat-steps" style="font-size:18px;">‚Äî</div>
          <div class="stat-delta" id="stat-steps-status">‚Äî</div>
        </div>
      </div>

      <!-- BP Summary -->
      <div class="section-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="bp-card">
        <div class="bp-card-title">üìä ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô</div>
        <div class="bp-readings">
          <div class="bp-reading">
            <div class="bp-reading-label">‡πÄ‡∏ä‡πâ‡∏≤ ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            <div class="bp-reading-val" id="bp-morning-avg">‚Äî/‚Äî</div>
            <div class="bp-reading-sub">mmHg</div>
          </div>
          <div class="bp-reading">
            <div class="bp-reading-label">‡πÄ‡∏¢‡πá‡∏ô ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
            <div class="bp-reading-val" id="bp-evening-avg">‚Äî/‚Äî</div>
            <div class="bp-reading-sub">mmHg</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ LOG TAB ‚îÄ‚îÄ -->
    <div class="log-section" id="tab-log">
      <div class="log-tabs">
        <button class="log-tab active" onclick="setLogTab('weight')">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</button>
        <button class="log-tab" onclick="setLogTab('food')">üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        <button class="log-tab" onclick="setLogTab('bp')">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</button>
        <button class="log-tab" onclick="setLogTab('exercise')">üí™ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á</button>
      </div>

      <!-- Weight Log -->
      <div id="log-weight">
        <div class="cal-summary" style="background:linear-gradient(135deg,var(--green-900),var(--green-600))">
          <div class="cal-row">
            <div class="cal-item">
              <div class="cal-item-val" id="disp-current-weight">‚Äî</div>
              <div class="cal-item-label">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (kg)</div>
            </div>
            <div class="cal-item">
              <div class="cal-item-val" id="disp-goal-weight">‚Äî</div>
              <div class="cal-item-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (kg)</div>
            </div>
            <div class="cal-item">
              <div class="cal-item-val" id="disp-lost">‚Äî</div>
              <div class="cal-item-label">‡∏•‡∏î‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (kg)</div>
            </div>
          </div>
        </div>
        <div class="field-group">
          <label class="field-label">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
          <input class="field-input" type="number" id="log-weight-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 91.5" step="0.1">
          <div class="field-hint">‡∏ß‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥ ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß</div>
        </div>
        <div class="field-group">
          <label class="field-label">‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß (cm) <span style="font-size:10px;color:var(--text-soft)">‡∏ó‡∏∏‡∏Å 2 ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå</span></label>
          <input class="field-input" type="number" id="log-waist-input" placeholder="‚Äî" step="0.5">
        </div>
        <div class="field-group">
          <label class="field-label">‡∏£‡∏≠‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å (cm)</label>
          <input class="field-input" type="number" id="log-hip-input" placeholder="‚Äî" step="0.5">
        </div>
        <div class="field-group">
          <label class="field-label">Body Fat% <span style="font-size:10px;color:var(--text-soft)">(‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</span></label>
          <input class="field-input" type="number" id="log-bf-input" placeholder="‚Äî" step="0.1">
        </div>
        <button class="btn-primary mt-12" onclick="saveWeight()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</button>
      </div>

      <!-- Food Log -->
      <div id="log-food" style="display:none">
        <div class="cal-summary">
          <div class="cal-row">
            <div class="cal-item">
              <div class="cal-item-val" id="cal-eaten">0</div>
              <div class="cal-item-label">‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
            </div>
            <div class="cal-item">
              <div class="cal-item-val" id="cal-goal-disp">1850</div>
              <div class="cal-item-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
            </div>
            <div class="cal-item">
              <div class="cal-item-val" id="cal-remain">1850</div>
              <div class="cal-item-label">‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å</div>
            </div>
          </div>
          <div class="cal-track">
            <div class="cal-fill" id="cal-bar" style="width:0%"></div>
          </div>
        </div>

        <!-- Meals -->
        <div class="meal-block">
          <div class="meal-header">
            <div class="meal-icon">üåÖ</div>
            <div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤</div>
            <div class="meal-cal" id="cal-breakfast">0 kcal</div>
          </div>
          <div class="meal-items" id="items-breakfast"></div>
          <button class="add-food-btn" onclick="openFoodModal('breakfast')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
        <div class="meal-block">
          <div class="meal-header">
            <div class="meal-icon">‚òÄÔ∏è</div>
            <div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô</div>
            <div class="meal-cal" id="cal-lunch">0 kcal</div>
          </div>
          <div class="meal-items" id="items-lunch"></div>
          <button class="add-food-btn" onclick="openFoodModal('lunch')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
        <div class="meal-block">
          <div class="meal-header">
            <div class="meal-icon">üåÜ</div>
            <div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô</div>
            <div class="meal-cal" id="cal-dinner">0 kcal</div>
          </div>
          <div class="meal-items" id="items-dinner"></div>
          <button class="add-food-btn" onclick="openFoodModal('dinner')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
        <div class="meal-block">
          <div class="meal-header">
            <div class="meal-icon">üçé</div>
            <div class="meal-title">Snacks</div>
            <div class="meal-cal" id="cal-snack">0 kcal</div>
          </div>
          <div class="meal-items" id="items-snack"></div>
          <button class="add-food-btn" onclick="openFoodModal('snack')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
        </div>
      </div>

      <!-- BP Log -->
      <div id="log-bp" style="display:none">
        <div style="background:var(--warn-soft);border-radius:14px;padding:12px 14px;margin-bottom:16px;border:1px solid #ffcdd2;">
          <div style="font-size:12px;font-weight:700;color:var(--warn)">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ</div>
          <div style="font-size:12px;color:#c62828;margin-top:4px;line-height:1.5">
            ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô 1‚Äì2 ‡∏ô‡∏≤‡∏ó‡∏µ<br>
            ‡πÄ‡∏¢‡πá‡∏ô 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô ¬∑ ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡∏û‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 5 ‡∏ô‡∏≤‡∏ó‡∏µ
          </div>
        </div>

        <div class="bp-time-block">
          <div class="bp-time-header">üåÖ ‡πÄ‡∏ä‡πâ‡∏≤ ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1</div>
          <div class="bp-inputs">
            <div class="bp-input-group">
              <div class="bp-input-label">Systolic</div>
              <input class="bp-input-field" type="number" id="bp-m1-sys" placeholder="120" oninput="checkBP('bp-m1-sys')">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Diastolic</div>
              <input class="bp-input-field" type="number" id="bp-m1-dia" placeholder="80">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Pulse</div>
              <input class="bp-input-field" type="number" id="bp-m1-pul" placeholder="72">
            </div>
          </div>
          <div class="bp-warn" id="warn-m1">‚ö†Ô∏è Systolic ‡∏™‡∏π‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ã‡πâ‡∏≥</div>
        </div>

        <div class="bp-time-block">
          <div class="bp-time-header">üåÖ ‡πÄ‡∏ä‡πâ‡∏≤ ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2</div>
          <div class="bp-inputs">
            <div class="bp-input-group">
              <div class="bp-input-label">Systolic</div>
              <input class="bp-input-field" type="number" id="bp-m2-sys" placeholder="120" oninput="checkBP('bp-m2-sys')">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Diastolic</div>
              <input class="bp-input-field" type="number" id="bp-m2-dia" placeholder="80">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Pulse</div>
              <input class="bp-input-field" type="number" id="bp-m2-pul" placeholder="72">
            </div>
          </div>
          <div class="bp-warn" id="warn-m2">‚ö†Ô∏è Systolic ‡∏™‡∏π‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ã‡πâ‡∏≥</div>
        </div>

        <div class="bp-time-block">
          <div class="bp-time-header">üåÜ ‡πÄ‡∏¢‡πá‡∏ô ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1</div>
          <div class="bp-inputs">
            <div class="bp-input-group">
              <div class="bp-input-label">Systolic</div>
              <input class="bp-input-field" type="number" id="bp-e1-sys" placeholder="120" oninput="checkBP('bp-e1-sys')">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Diastolic</div>
              <input class="bp-input-field" type="number" id="bp-e1-dia" placeholder="80">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Pulse</div>
              <input class="bp-input-field" type="number" id="bp-e1-pul" placeholder="72">
            </div>
          </div>
          <div class="bp-warn" id="warn-e1">‚ö†Ô∏è Systolic ‡∏™‡∏π‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ã‡πâ‡∏≥</div>
        </div>

        <div class="bp-time-block">
          <div class="bp-time-header">üåÜ ‡πÄ‡∏¢‡πá‡∏ô ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2</div>
          <div class="bp-inputs">
            <div class="bp-input-group">
              <div class="bp-input-label">Systolic</div>
              <input class="bp-input-field" type="number" id="bp-e2-sys" placeholder="120" oninput="checkBP('bp-e2-sys')">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Diastolic</div>
              <input class="bp-input-field" type="number" id="bp-e2-dia" placeholder="80">
            </div>
            <div class="bp-input-group">
              <div class="bp-input-label">Pulse</div>
              <input class="bp-input-field" type="number" id="bp-e2-pul" placeholder="72">
            </div>
          </div>
          <div class="bp-warn" id="warn-e2">‚ö†Ô∏è Systolic ‡∏™‡∏π‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ã‡πâ‡∏≥</div>
        </div>

        <button class="btn-primary mt-12" onclick="saveBP()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</button>
      </div>

      <!-- Exercise Log -->
      <div id="log-exercise" style="display:none">
        <div id="exercise-checklist-log"></div>

        <!-- Cal Burn from Watch -->
        <div style="background:var(--green-50);border-radius:16px;padding:16px;margin-top:16px;border:1.5px solid var(--green-100);">
          <div style="font-size:12px;font-weight:700;color:var(--green-700);margin-bottom:12px;letter-spacing:0.3px;">üî• Cal ‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ <span style="font-weight:400;color:var(--text-soft)">(‡∏à‡∏≤‡∏Å‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤)</span></div>
          <input class="field-input" type="number" id="inp-cal-burn" placeholder="0"
            style="font-size:28px;font-weight:800;text-align:center;border:none;background:white;border-radius:12px;padding:12px;" oninput="updateCalBurnDisplay()">
          <div style="font-size:12px;color:var(--green-700);text-align:center;margin-top:8px;font-weight:600;">
            <span id="cal-burn-hint">‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤</span>
          </div>
          <!-- Quick presets -->
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:12px;justify-content:center;">
            <button onclick="setCalBurn(200)" style="padding:6px 14px;border-radius:20px;border:1.5px solid var(--green-500);background:white;color:var(--green-700);font-size:12px;font-weight:600;cursor:pointer;">üèÉ 200</button>
            <button onclick="setCalBurn(280)" style="padding:6px 14px;border-radius:20px;border:1.5px solid var(--green-500);background:white;color:var(--green-700);font-size:12px;font-weight:600;cursor:pointer;">üèÉ 280</button>
            <button onclick="setCalBurn(150)" style="padding:6px 14px;border-radius:20px;border:1.5px solid var(--green-500);background:white;color:var(--green-700);font-size:12px;font-weight:600;cursor:pointer;">üí™ 150</button>
            <button onclick="setCalBurn(220)" style="padding:6px 14px;border-radius:20px;border:1.5px solid var(--green-500);background:white;color:var(--green-700);font-size:12px;font-weight:600;cursor:pointer;">üí™ 220</button>
            <button onclick="setCalBurn(80)" style="padding:6px 14px;border-radius:20px;border:1.5px solid var(--green-500);background:white;color:var(--green-700);font-size:12px;font-weight:600;cursor:pointer;">üö∂ 80</button>
          </div>
        </div>

        <!-- Steps (Daily total) -->
        <div style="background:var(--card);border-radius:16px;padding:14px 16px;margin-top:10px;border:1.5px solid var(--border);display:flex;align-items:center;gap:12px;">
          <div style="font-size:28px;">üëü</div>
          <div style="flex:1;">
            <div style="font-size:12px;color:var(--text-soft);margin-bottom:2px;">‡∏Å‡πâ‡∏≤‡∏ß‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏à‡∏≤‡∏Å‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤)</div>
            <input type="number" id="inp-steps" placeholder="‡πÄ‡∏ä‡πà‡∏ô 8,500"
              style="width:100%;border:none;background:transparent;font-size:18px;font-weight:700;color:var(--text);outline:none;padding:0;">
          </div>
          <div style="text-align:right;font-size:11px;color:var(--text-soft);">‡πÄ‡∏õ‡πâ‡∏≤<br><b style="color:var(--green-700)">10,000</b></div>
        </div>

        <div class="field-group mt-20">
          <label class="field-label">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢</label>
          <div class="toggle-group">
            <button class="toggle-btn" onclick="setRPE(1)" id="rpe-1">üò¥ ‡πÄ‡∏ö‡∏≤</button>
            <button class="toggle-btn" onclick="setRPE(2)" id="rpe-2">üòê ‡∏õ‡∏≤‡∏ô</button>
            <button class="toggle-btn" onclick="setRPE(3)" id="rpe-3">üí™ ‡∏´‡∏ô‡∏±‡∏Å</button>
            <button class="toggle-btn" onclick="setRPE(4)" id="rpe-4">üî• Max</button>
          </div>
        </div>
        <div class="field-group">
          <label class="field-label">‡πÇ‡∏ô‡πâ‡∏ï</label>
          <input class="field-input" type="text" id="exercise-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å dumbbell ‡πÄ‡∏õ‡πá‡∏ô 6kg">
        </div>
        <button class="btn-primary mt-12" onclick="saveExercise()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢</button>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ PROGRESS TAB ‚îÄ‚îÄ -->
    <div class="log-section" id="tab-progress">
      <div class="progress-tabs">
        <button class="progress-tab active" onclick="setProgressTab('weight')">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</button>
        <button class="progress-tab" onclick="setProgressTab('cal')">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà</button>
        <button class="progress-tab" onclick="setProgressTab('bp')">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</button>
      </div>

      <div id="prog-weight">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title">üìâ ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
            <div class="chart-tabs">
              <button class="chart-tab active" onclick="setChartRange('4w')">4W</button>
              <button class="chart-tab" onclick="setChartRange('8w')">8W</button>
            </div>
          </div>
          <canvas id="chart-weight" height="180"></canvas>
        </div>
        <div class="week-summary mt-12">
          <div class="week-summary-title">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
          <div class="week-metric">
            <span class="week-metric-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</span>
            <span class="week-metric-val" id="ws-start">‚Äî kg</span>
          </div>
          <div class="week-metric">
            <span class="week-metric-label">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
            <span class="week-metric-val" id="ws-current">‚Äî kg</span>
          </div>
          <div class="week-metric">
            <span class="week-metric-label">‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</span>
            <span class="week-metric-val" id="ws-lost">‚Äî kg</span>
          </div>
          <div class="week-metric">
            <span class="week-metric-label">BMI ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
            <span class="week-metric-val" id="ws-bmi">‚Äî</span>
          </div>
        </div>
      </div>

      <div id="prog-cal" style="display:none">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title">üî• ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</div>
          </div>
          <canvas id="chart-cal" height="180"></canvas>
        </div>
      </div>

      <div id="prog-bp" style="display:none">
        <div class="chart-card">
          <div class="chart-header">
            <div class="chart-title">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï (14 ‡∏ß‡∏±‡∏ô)</div>
          </div>
          <canvas id="chart-bp" height="180"></canvas>
        </div>
        <div class="week-summary mt-12">
          <div class="week-summary-title">ü©∫ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
          <div class="week-metric">
            <span class="week-metric-label">Systolic ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
            <span class="week-metric-val" id="avg-sys">‚Äî mmHg</span>
          </div>
          <div class="week-metric">
            <span class="week-metric-label">Diastolic ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
            <span class="week-metric-val" id="avg-dia">‚Äî mmHg</span>
          </div>
          <div class="week-metric">
            <span class="week-metric-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
            <span class="week-metric-val" id="bp-status-text"><span class="badge badge-green">‡∏õ‡∏Å‡∏ï‡∏¥</span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ PLAN TAB ‚îÄ‚îÄ -->
    <div class="log-section" id="tab-plan">
      <div class="section-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</div>
      <div id="full-week-plan"></div>

      <div class="section-title">‡πÅ‡∏ú‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
      <div class="meal-block">
        <div class="meal-header"><div class="meal-icon">üåÖ</div><div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (~350‚Äì400 kcal)</div></div>
        <div class="meal-items">
          <div class="meal-item"><span class="meal-item-name">ü•£ Overnight oats + chia + ‡∏Å‡∏•‡πâ‡∏ß‡∏¢</span><span class="meal-item-cal">~360</span></div>
          <div class="meal-item"><span class="meal-item-name">ü•ö ‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° 2 ‡∏ü‡∏≠‡∏á + ‡∏Å‡∏•‡πâ‡∏ß‡∏¢ + ‡πÇ‡∏Æ‡∏•‡∏ß‡∏µ‡∏ï</span><span class="meal-item-cal">~350</span></div>
          <div class="meal-item"><span class="meal-item-name">ü•õ Greek yogurt + ‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° + ‡∏ù‡∏£‡∏±‡πà‡∏á</span><span class="meal-item-cal">~300</span></div>
        </div>
      </div>
      <div class="meal-block">
        <div class="meal-header"><div class="meal-icon">‚òÄÔ∏è</div><div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (~500‚Äì550 kcal)</div></div>
        <div class="meal-items">
          <div class="meal-item"><span class="meal-item-name">üçö ‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á + ‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á + ‡∏ú‡∏±‡∏î‡∏ú‡∏±‡∏Å + ‡∏ï‡πâ‡∏°‡∏¢‡∏≥‡πÉ‡∏™</span><span class="meal-item-cal">~500</span></div>
          <div class="meal-item"><span class="meal-item-name">ü•™ ‡πÅ‡∏ã‡∏ô‡∏î‡πå‡∏ß‡∏¥‡∏ä‡∏ó‡∏π‡∏ô‡πà‡∏≤‡πÇ‡∏Æ‡∏•‡∏ß‡∏µ‡∏ï + ‡∏ä‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß</span><span class="meal-item-cal">~450</span></div>
        </div>
      </div>
      <div class="meal-block">
        <div class="meal-header"><div class="meal-icon">üåÜ</div><div class="meal-title">‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô (~450‚Äì500 kcal)</div></div>
        <div class="meal-items">
          <div class="meal-item"><span class="meal-item-name">üç≤ ‡∏ï‡πâ‡∏°‡∏¢‡∏≥ + ‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á ¬Ω ‡∏ñ‡πâ‡∏ß‡∏¢</span><span class="meal-item-cal">~450</span></div>
          <div class="meal-item"><span class="meal-item-name">üêü ‡∏õ‡∏•‡∏≤‡∏ô‡∏∂‡πà‡∏á‡∏°‡∏∞‡∏ô‡∏≤‡∏ß + ‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á + ‡∏Ç‡πâ‡∏≤‡∏ß</span><span class="meal-item-cal">~480</span></div>
        </div>
      </div>

      <div class="section-title">‚ùå ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á</div>
      <div style="background:var(--warn-soft);border-radius:14px;padding:14px;border:1px solid #ffcdd2;">
        <div style="display:flex;flex-wrap:wrap;gap:8px;">
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Ø</span>
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢</span>
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡∏Ç‡∏≠‡∏á‡∏ó‡∏≠‡∏î</span>
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å</span>
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞</span>
          <span style="background:#fff;padding:4px 10px;border-radius:20px;font-size:12px;color:var(--warn);border:1px solid #ffcdd2">‡∏Å‡∏∞‡∏ó‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô</span>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ SETTINGS TAB ‚îÄ‚îÄ -->
    <div class="log-section" id="tab-settings">
      <div class="section-title">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
      <div class="settings-section">
        <div class="settings-row" onclick="goTo('screen-onboard'); setOnboardStep(1)">
          <div class="settings-icon">üë§</div>
          <div class="settings-label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</div>
          <div class="settings-value" id="set-profile-val">‚Äî</div>
          <div class="settings-arrow">‚Ä∫</div>
        </div>
        <div class="settings-row" onclick="goTo('screen-onboard'); setOnboardStep(2)">
          <div class="settings-icon">üéØ</div>
          <div class="settings-label">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
          <div class="settings-value" id="set-goal-val">‚Äî</div>
          <div class="settings-arrow">‚Ä∫</div>
        </div>
      </div>

      <div class="section-title">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
      <div class="settings-section">
        <div class="settings-row" onclick="goTo('screen-onboard'); setOnboardStep(4)">
          <div class="settings-icon">üí¨</div>
          <div class="settings-label">Line Notify</div>
          <div class="settings-value" id="set-line-val">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
          <div class="settings-arrow">‚Ä∫</div>
        </div>
      </div>

      <div class="section-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
      <div class="settings-section">
        <div class="settings-row" onclick="exportCSV()">
          <div class="settings-icon">üì§</div>
          <div class="settings-label">Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV</div>
          <div class="settings-arrow">‚Ä∫</div>
        </div>
        <div class="settings-row" onclick="clearData()">
          <div class="settings-icon">üóëÔ∏è</div>
          <div class="settings-label" style="color:var(--warn)">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div class="settings-arrow">‚Ä∫</div>
        </div>
      </div>

      <div class="text-center" style="padding:20px;color:var(--text-soft);font-size:12px;">
        PIMOU v1.0 ¬∑ Made with üåø
      </div>
    </div>

  </div><!-- /content -->

  <!-- BOTTOM NAV -->
  <div class="bottom-nav">
    <div class="nav-item active" id="nav-home" onclick="setTab('home')">
      <div class="nav-icon">üè†</div>
      <div class="nav-label" data-i18n="nav_home">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</div>
    </div>
    <div class="nav-item" id="nav-log" onclick="setTab('log')">
      <div class="nav-icon">üìù</div>
      <div class="nav-label" data-i18n="nav_log">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
    </div>
    <div class="nav-item" id="nav-progress" onclick="setTab('progress')">
      <div class="nav-icon">üìä</div>
      <div class="nav-label" data-i18n="nav_progress">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
    </div>
    <div class="nav-item" id="nav-plan" onclick="setTab('plan')">
      <div class="nav-icon">üóìÔ∏è</div>
      <div class="nav-label" data-i18n="nav_plan">‡πÅ‡∏ú‡∏ô</div>
    </div>
    <div class="nav-item" id="nav-settings" onclick="setTab('settings')">
      <div class="nav-icon">‚öôÔ∏è</div>
      <div class="nav-label" data-i18n="nav_settings">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MODAL: ADD FOOD
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="modal-overlay" id="food-modal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>

    <div class="field-group">
      <label class="field-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π</label>
      <input class="field-input" type="text" id="food-name-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á">
    </div>
    <div class="field-row">
      <div class="field-group">
        <label class="field-label">‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà (kcal)</label>
        <input class="field-input" type="number" id="food-cal-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 450">
      </div>
      <div class="field-group">
        <label class="field-label">‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô (g)</label>
        <input class="field-input" type="number" id="food-protein-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô 35">
      </div>
    </div>

    <div class="field-group">
      <label class="field-label">‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡∏ö‡πà‡∏≠‡∏¢ (‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</label>
      <div class="quick-foods" id="quick-foods-list"></div>
    </div>

    <button class="btn-primary" onclick="addFood()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
    <button class="btn-secondary" onclick="closeFoodModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê CHART.JS ‚ïê‚ïê‚ïê -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let profile = {};
let conditions = { hypertension: true, diabetes: false, other: false };
let gender = 'female';
let currentStep = 1;
let currentTab = 'home';
let currentLogTab = 'weight';
let currentProgressTab = 'weight';
let currentFoodMeal = 'breakfast';
let currentRPE = 0;
let currentLang = localStorage.getItem('pimou_lang') || 'th';

let logs = { weights: [], bp: [], food: {}, exercise: {} };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// i18n TRANSLATIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const I18N = {
  th: {
    // Welcome
    welcome_sub: 'Health Tracker',
    welcome_desc: '‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô\n‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß',
    welcome_start: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‚Üí',
    welcome_existing: '‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß',

    // Onboarding steps
    step_labels: ['‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1 ‡∏à‡∏≤‡∏Å 4','‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏à‡∏≤‡∏Å 4','‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3 ‡∏à‡∏≤‡∏Å 4','‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 4 ‡∏à‡∏≤‡∏Å 4'],
    step_titles: ['‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß','‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢','‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢','‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô'],

    // Form labels
    nickname: '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô',
    nickname_ph: '‡πÄ‡∏ä‡πà‡∏ô PIM',
    gender: '‡πÄ‡∏û‡∏®',
    female: '‚ôÄ ‡∏´‡∏ç‡∏¥‡∏á',
    male: '‚ôÇ ‡∏ä‡∏≤‡∏¢',
    age: '‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)',
    height: '‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)',
    weight: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)',
    body_fat: 'Body Fat%',
    body_fat_hint: '(‡∏ñ‡πâ‡∏≤‡∏ó‡∏£‡∏≤‡∏ö)',
    conditions_label: '‡πÇ‡∏£‡∏Ñ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß',
    cond_bp: '‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á',
    cond_dm: 'ü©∫ ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô',
    cond_other: 'üíä ‡∏≠‡∏∑‡πà‡∏ô‡πÜ',
    meds: '‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥',
    meds_ph: '‡πÄ‡∏ä‡πà‡∏ô Amlodipine 5mg ‡πÄ‡∏ä‡πâ‡∏≤',
    next: '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí',
    back: '‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö',

    // Step 2
    goal_weight: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (kg)',
    months: '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)',
    activity: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏Å',
    activity_opts: ['ü™ë ‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡∏Ç‡∏¢‡∏±‡∏ö','üö∂ ‡πÄ‡∏î‡∏¥‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ö‡∏≤','üèÉ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠','üí™ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô','üî• ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏≤‡∏Å'],
    cal_target_label: '‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢/‡∏ß‡∏±‡∏ô (‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ)',
    cal_target_hint: '‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£',
    calc_bmi: 'BMI',
    calc_bmr: 'BMR (‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô)',
    calc_tdee: 'TDEE (‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)',
    calc_target: 'üéØ ‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà/‡∏ß‡∏±‡∏ô',
    calc_loss: '‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì',
    calc_loss_unit: 'kg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',

    // Step 3
    schedule_hint: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á',

    // Step 4
    line_token: 'Line Notify Token',
    line_token_hint: '‡∏£‡∏±‡∏ö Token ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà notify.line.me ‚Üí Personal Access Tokens',
    notif_title: '‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
    notif_morning: '‡πÄ‡∏ä‡πâ‡∏≤ (‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô)',
    notif_noon: '‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (log ‡∏≠‡∏≤‡∏´‡∏≤‡∏£)',
    notif_evening: '‡πÄ‡∏¢‡πá‡∏ô (‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô)',
    notif_night: '‡∏Ñ‡πà‡∏≥ (‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô)',
    line_name: '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡∏ô Line',
    line_name_ph: '‡πÄ‡∏ä‡πà‡∏ô PIM',
    line_name_hint: '‡πÉ‡∏ä‡πâ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
    finish_btn: 'üåø ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô PIMOU!',

    // Top bar greetings
    good_morning: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ üåø',
    good_afternoon: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡∏ö‡πà‡∏≤‡∏¢ ‚òÄÔ∏è',
    good_evening: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏¢‡πá‡∏ô üåô',

    // Dashboard
    progress_label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤',
    day_label: 'Day',
    remaining: '‡πÄ‡∏´‡∏•‡∏∑‡∏≠',
    goal: '‡πÄ‡∏õ‡πâ‡∏≤',
    today_done: '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°?',
    this_week: '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ',
    latest_stats: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
    bp_today: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
    bp_avg: 'üìä ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô',
    morning_avg: '‡πÄ‡∏ä‡πâ‡∏≤ ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
    evening_avg: '‡πÄ‡∏¢‡πá‡∏ô ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',

    // Stats
    stat_weight: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
    stat_cal: 'Cal ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
    stat_bp: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',
    stat_bmi: 'BMI',

    // Checklist items
    check_cardio: 'Cardio + HIIT',
    check_cardio_time: '‡πÄ‡∏ä‡πâ‡∏≤ 30 ‡∏ô‡∏≤‡∏ó‡∏µ',
    check_pt: 'PT at Gym',
    check_pt_time: '‡πÄ‡∏¢‡πá‡∏ô 60 ‡∏ô‡∏≤‡∏ó‡∏µ',
    check_pilates: 'Pilates',
    check_walk: '‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏ß‡∏ô',
    check_bp_morning: '‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤',
    check_bp_morning_time: '‡∏Å‡πà‡∏≠‡∏ô 9 ‡πÇ‡∏°‡∏á',
    check_bp_evening: '‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏¢‡πá‡∏ô',
    check_bp_evening_time: '‡∏Å‡πà‡∏≠‡∏ô 2 ‡∏ó‡∏∏‡πà‡∏°',
    check_food_log: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
    check_food_log_time: '‡∏ó‡∏∏‡∏Å‡∏°‡∏∑‡πâ‡∏≠',

    // Log tabs
    log_weight: '‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
    log_food: 'üçΩÔ∏è ‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
    log_bp: '‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',
    log_exercise: 'üí™ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á',

    // Weight log
    log_weight_title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
    log_weight_hint: '‡∏ß‡∏±‡∏î‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥ ‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏¥‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß',
    log_waist: '‡∏£‡∏≠‡∏ö‡πÄ‡∏≠‡∏ß (cm)',
    log_waist_hint: '‡∏ó‡∏∏‡∏Å 2 ‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå',
    log_hip: '‡∏£‡∏≠‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å (cm)',
    log_bf: 'Body Fat%',
    log_bf_hint: '(‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)',
    save_weight_btn: 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
    current_weight: '‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (kg)',
    goal_weight_disp: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (kg)',
    lost_so_far: '‡∏•‡∏î‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (kg)',

    // Food log
    cal_eaten: '‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
    cal_remaining: '‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏µ‡∏Å',
    meal_breakfast: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤',
    meal_lunch: '‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô',
    meal_dinner: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô',
    meal_snack: 'Snacks',
    add_food: '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£',

    // BP log
    bp_warning: '‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏π‡πâ',
    bp_warning_text: '‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤ 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô 1‚Äì2 ‡∏ô‡∏≤‡∏ó‡∏µ\n‡πÄ‡∏¢‡πá‡∏ô 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô ¬∑ ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏î‡∏û‡∏±‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 5 ‡∏ô‡∏≤‡∏ó‡∏µ',
    bp_m1: 'üåÖ ‡πÄ‡∏ä‡πâ‡∏≤ ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1',
    bp_m2: 'üåÖ ‡πÄ‡∏ä‡πâ‡∏≤ ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2',
    bp_e1: 'üåÜ ‡πÄ‡∏¢‡πá‡∏ô ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1',
    bp_e2: 'üåÜ ‡πÄ‡∏¢‡πá‡∏ô ‚Äî ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2',
    bp_sys: 'Systolic',
    bp_dia: 'Diastolic',
    bp_pulse: 'Pulse',
    bp_high_warn: '‚ö†Ô∏è Systolic ‡∏™‡∏π‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏î‡∏ã‡πâ‡∏≥',
    save_bp_btn: 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',

    // Exercise log
    rpe_label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢',
    rpe_1: 'üò¥ ‡πÄ‡∏ö‡∏≤', rpe_2: 'üòê ‡∏õ‡∏≤‡∏ô', rpe_3: 'üí™ ‡∏´‡∏ô‡∏±‡∏Å', rpe_4: 'üî• Max',
    note_label: '‡πÇ‡∏ô‡πâ‡∏ï',
    note_ph: '‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å dumbbell ‡πÄ‡∏õ‡πá‡∏ô 6kg',
    save_exercise_btn: 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢',

    // Progress
    prog_weight: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
    prog_cal: '‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà',
    prog_bp: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',
    weight_chart_title: 'üìâ ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
    cal_chart_title: 'üî• ‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)',
    bp_chart_title: '‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï (14 ‡∏ß‡∏±‡∏ô)',
    week_summary_title: 'üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
    ws_start: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',
    ws_current: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
    ws_lost: '‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ',
    ws_bmi: 'BMI ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',
    bp_avg_7: 'ü©∫ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
    avg_sys: 'Systolic ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
    avg_dia: 'Diastolic ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
    bp_status: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',

    // Plan tab
    exercise_plan_title: '‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå',
    meal_plan_title: '‡πÅ‡∏ú‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
    avoid_title: '‚ùå ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á',
    meal_breakfast_cal: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏ä‡πâ‡∏≤ (~350‚Äì400 kcal)',
    meal_lunch_cal: '‡∏°‡∏∑‡πâ‡∏≠‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô (~500‚Äì550 kcal)',
    meal_dinner_cal: '‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô (~450‚Äì500 kcal)',
    avoid_items: ['‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Ø','‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢','‡∏Ç‡∏≠‡∏á‡∏ó‡∏≠‡∏î','‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å','‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤‡πÄ‡∏¢‡∏≠‡∏∞','‡∏Å‡∏∞‡∏ó‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô'],

    // Settings
    settings_profile: '‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå',
    settings_personal: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß',
    settings_goal: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢',
    settings_notifications: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',
    settings_line: 'Line Notify',
    settings_data: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
    settings_export: 'Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV',
    settings_delete: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
    settings_line_connected: '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úì',
    settings_line_setup: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',

    // Nav
    nav_home: '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
    nav_log: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
    nav_progress: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤',
    nav_plan: '‡πÅ‡∏ú‡∏ô',
    nav_settings: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',

    // Modal
    modal_add_food: '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
    food_name: '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π',
    food_name_ph: '‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Å‡πà‡∏¢‡πà‡∏≤‡∏á',
    food_cal: '‡πÅ‡∏Ñ‡∏•‡∏≠‡∏£‡∏µ‡πà (kcal)',
    food_cal_ph: '‡πÄ‡∏ä‡πà‡∏ô 450',
    food_protein: '‡πÇ‡∏õ‡∏£‡∏ï‡∏µ‡∏ô (g)',
    food_protein_ph: '‡πÄ‡∏ä‡πà‡∏ô 35',
    quick_foods_label: '‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Å‡∏¥‡∏ô‡∏ö‡πà‡∏≠‡∏¢ (‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)',
    add_btn: '+ ‡πÄ‡∏û‡∏¥‡πà‡∏°',
    cancel_btn: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',

    // Day schedule
    morning: '‡πÄ‡∏ä‡πâ‡∏≤',
    afternoon: '‡∏ö‡πà‡∏≤‡∏¢',
    evening: '‡πÄ‡∏¢‡πá‡∏ô',
    day_short: ['‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™','‡∏≠‡∏≤'],
    day_full: ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå','‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'],

    // Toast
    toast_saved: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + sync Sheets ‡πÅ‡∏•‡πâ‡∏ß! üìä',
    toast_offline: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (offline)',
    toast_weight_saved: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + sync Sheets ‡πÅ‡∏•‡πâ‡∏ß! üìä',
    toast_bp_saved: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô + sync ‡πÅ‡∏•‡πâ‡∏ß! üìä',
    toast_exercise_saved: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + sync ‡πÅ‡∏•‡πâ‡∏ß! üìä',
    toast_food_added: '‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡πâ‡∏ß!',
    toast_export: '‚úì Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
    toast_deleted: 'üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß',
    toast_done: '‚úì ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!',
    toast_cancel: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß',
    toast_need_weight: '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
    toast_need_food: '‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π',
    syncing: '‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...',
    confirm_delete: '‚ö†Ô∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ',

    // Version
    version: 'PIMOU v1.0 ¬∑ Made with üåø',

    // Language toggle
    lang_toggle: 'EN',
  },

  en: {
    welcome_sub: 'Health Tracker',
    welcome_desc: 'Track weight, calories, blood pressure\nand workouts\nall in one place',
    welcome_start: 'Get Started ‚Üí',
    welcome_existing: 'I already have an account',

    step_labels: ['Step 1 of 4','Step 2 of 4','Step 3 of 4','Step 4 of 4'],
    step_titles: ['Personal Info','Set Your Goal','Exercise Schedule','Notifications'],

    nickname: 'Nickname',
    nickname_ph: 'e.g. PIM',
    gender: 'Gender',
    female: '‚ôÄ Female',
    male: '‚ôÇ Male',
    age: 'Age (years)',
    height: 'Height (cm)',
    weight: 'Weight (kg)',
    body_fat: 'Body Fat%',
    body_fat_hint: '(if known)',
    conditions_label: 'Medical Conditions',
    cond_bp: '‚ù§Ô∏è High Blood Pressure',
    cond_dm: 'ü©∫ Diabetes',
    cond_other: 'üíä Other',
    meds: 'Regular Medications',
    meds_ph: 'e.g. Amlodipine 5mg morning',
    next: 'Next ‚Üí',
    back: '‚Üê Back',

    goal_weight: 'Target Weight (kg)',
    months: 'Duration (months)',
    activity: 'Activity Level',
    activity_opts: ['ü™ë Sedentary, little movement','üö∂ Light exercise occasionally','üèÉ Regular exercise','üí™ Daily exercise','üî• Very intense exercise'],
    cal_target_label: 'Daily Calorie Target (adjustable)',
    cal_target_hint: 'Auto-recommended, but you can adjust',
    calc_bmi: 'BMI',
    calc_bmr: 'BMR (Baseline)',
    calc_tdee: 'TDEE (Active)',
    calc_target: 'üéØ Daily Calorie Target',
    calc_loss: 'Expected loss',
    calc_loss_unit: 'kg/week',

    schedule_hint: 'Confirm your exercise schedule ‚Äî you can edit this later',

    line_token: 'Line Notify Token',
    line_token_hint: 'Get token at notify.line.me ‚Üí Personal Access Tokens',
    notif_title: '‚è∞ Notification Times',
    notif_morning: 'Morning (BP check)',
    notif_noon: 'Noon (log food)',
    notif_evening: 'Evening (BP check)',
    notif_night: 'Night (daily summary)',
    line_name: 'Your Line Display Name',
    line_name_ph: 'e.g. PIM',
    line_name_hint: 'Used in notification messages',
    finish_btn: 'üåø Start Using PIMOU!',

    good_morning: 'Good Morning üåø',
    good_afternoon: 'Good Afternoon ‚òÄÔ∏è',
    good_evening: 'Good Evening üåô',

    progress_label: 'Progress',
    day_label: 'Day',
    remaining: 'Left',
    goal: 'Goal',
    today_done: "Today's Checklist",
    this_week: 'This Week',
    latest_stats: 'Latest Stats',
    bp_today: "Today's BP",
    bp_avg: 'üìä Daily Average',
    morning_avg: 'Morning Avg',
    evening_avg: 'Evening Avg',

    stat_weight: 'Weight',
    stat_cal: "Today's Cal",
    stat_bp: 'Blood Pressure',
    stat_bmi: 'BMI',

    check_cardio: 'Cardio + HIIT',
    check_cardio_time: 'Morning ¬∑ 30 min',
    check_pt: 'PT at Gym',
    check_pt_time: 'Evening ¬∑ 60 min',
    check_pilates: 'Pilates',
    check_walk: 'Park Walk',
    check_bp_morning: 'Morning BP Check',
    check_bp_morning_time: 'Before 9am',
    check_bp_evening: 'Evening BP Check',
    check_bp_evening_time: 'Before 8pm',
    check_food_log: 'Log Food',
    check_food_log_time: 'Every meal',

    log_weight: '‚öñÔ∏è Weight',
    log_food: 'üçΩÔ∏è Food',
    log_bp: '‚ù§Ô∏è Blood Pressure',
    log_exercise: 'üí™ Exercise',

    log_weight_title: "Log Today's Weight",
    log_weight_hint: 'Weigh in the morning, after bathroom, before eating',
    log_waist: 'Waist (cm)',
    log_waist_hint: 'Every 2 weeks',
    log_hip: 'Hip (cm)',
    log_bf: 'Body Fat%',
    log_bf_hint: '(if available)',
    save_weight_btn: 'üíæ Save Weight',
    current_weight: 'Current (kg)',
    goal_weight_disp: 'Goal (kg)',
    lost_so_far: 'Lost So Far (kg)',

    cal_eaten: 'Consumed',
    cal_remaining: 'Remaining',
    meal_breakfast: 'Breakfast',
    meal_lunch: 'Lunch',
    meal_dinner: 'Dinner',
    meal_snack: 'Snacks',
    add_food: '+ Add Food',

    bp_warning: '‚ö†Ô∏è Important',
    bp_warning_text: 'Take BP twice in the morning, 1‚Äì2 min apart\nSame for evening ¬∑ Rest 5 min before measuring',
    bp_m1: 'üåÖ Morning ‚Äî Reading 1',
    bp_m2: 'üåÖ Morning ‚Äî Reading 2',
    bp_e1: 'üåÜ Evening ‚Äî Reading 1',
    bp_e2: 'üåÜ Evening ‚Äî Reading 2',
    bp_sys: 'Systolic',
    bp_dia: 'Diastolic',
    bp_pulse: 'Pulse',
    bp_high_warn: '‚ö†Ô∏è Systolic is high! Rest and re-measure.',
    save_bp_btn: 'üíæ Save Blood Pressure',

    rpe_label: 'Exertion Level',
    rpe_1: 'üò¥ Easy', rpe_2: 'üòê Moderate', rpe_3: 'üí™ Hard', rpe_4: 'üî• Max',
    note_label: 'Notes',
    note_ph: 'e.g. Increased dumbbell to 6kg',
    save_exercise_btn: 'üíæ Save Exercise Log',

    prog_weight: 'Weight',
    prog_cal: 'Calories',
    prog_bp: 'Blood Pressure',
    weight_chart_title: 'üìâ Weekly Weight Trend',
    cal_chart_title: 'üî• Daily Calories (Last 7 Days)',
    bp_chart_title: '‚ù§Ô∏è Blood Pressure (14 Days)',
    week_summary_title: 'üìä This Week Summary',
    ws_start: 'Starting Weight',
    ws_current: 'Latest Weight',
    ws_lost: 'Lost This Week',
    ws_bmi: 'Current BMI',
    bp_avg_7: 'ü©∫ 7-Day Average',
    avg_sys: 'Avg Systolic',
    avg_dia: 'Avg Diastolic',
    bp_status: 'Latest Status',

    exercise_plan_title: 'Weekly Exercise Schedule',
    meal_plan_title: 'Meal Plan',
    avoid_title: '‚ùå Avoid',
    meal_breakfast_cal: 'Breakfast (~350‚Äì400 kcal)',
    meal_lunch_cal: 'Lunch (~500‚Äì550 kcal)',
    meal_dinner_cal: 'Dinner (~450‚Äì500 kcal)',
    avoid_items: ['Instant noodles','Thai iced tea','Fried food','Processed sausage','Heavy fish sauce','Daily coconut milk'],

    settings_profile: 'Profile',
    settings_personal: 'Personal Info',
    settings_goal: 'Goal',
    settings_notifications: 'Notifications',
    settings_line: 'Line Notify',
    settings_data: 'Data',
    settings_export: 'Export Data as CSV',
    settings_delete: 'Delete All Data',
    settings_line_connected: 'Connected ‚úì',
    settings_line_setup: 'Set Up',

    nav_home: 'Home',
    nav_log: 'Log',
    nav_progress: 'Progress',
    nav_plan: 'Plan',
    nav_settings: 'Settings',

    modal_add_food: '+ Add Food',
    food_name: 'Food Name',
    food_name_ph: 'e.g. Grilled Chicken Rice',
    food_cal: 'Calories (kcal)',
    food_cal_ph: 'e.g. 450',
    food_protein: 'Protein (g)',
    food_protein_ph: 'e.g. 35',
    quick_foods_label: 'Quick Add (tap to select)',
    add_btn: '+ Add',
    cancel_btn: 'Cancel',

    morning: 'Morning',
    afternoon: 'Afternoon',
    evening: 'Evening',
    day_short: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
    day_full: ['Monday','Tuesday','Wednesday','Thursday','Friday','Saturday','Sunday'],

    toast_saved: '‚úì Saved + synced to Sheets! üìä',
    toast_offline: '‚úì Saved (offline)',
    toast_weight_saved: '‚úì Weight saved + synced! üìä',
    toast_bp_saved: '‚úì BP saved + synced! üìä',
    toast_exercise_saved: '‚úì Exercise saved + synced! üìä',
    toast_food_added: '‚úì Food added!',
    toast_export: '‚úì Export successful!',
    toast_deleted: 'üóëÔ∏è Data deleted',
    toast_done: '‚úì Done!',
    toast_cancel: 'Cancelled',
    toast_need_weight: '‚ö†Ô∏è Please enter your weight',
    toast_need_food: '‚ö†Ô∏è Please enter a food name',
    syncing: 'Syncing...',
    confirm_delete: '‚ö†Ô∏è Delete all data? This cannot be undone.',

    version: 'PIMOU v1.0 ¬∑ Made with üåø',

    lang_toggle: '‡πÑ‡∏ó‡∏¢',
  }
};

function t(key) {
  return I18N[currentLang][key] || I18N['th'][key] || key;
}

function toggleLang() {
  currentLang = currentLang === 'th' ? 'en' : 'th';
  localStorage.setItem('pimou_lang', currentLang);
  applyLang();
}

function applyLang() {
  // Update lang toggle buttons
  const wb = document.getElementById('welcome-lang-btn');
  if (wb) wb.textContent = t('lang_toggle');
  const ab = document.getElementById('lang-btn');
  if (ab) ab.textContent = t('lang_toggle');

  // Update html lang attribute
  document.documentElement.lang = currentLang;

  // Apply all data-i18n
  applyDataI18n();

  // Re-render dynamic sections
  const currentScreen = document.querySelector('.screen.active')?.id;
  if (currentScreen === 'screen-app') {
    updateAppUI();
    renderTodayChecklist();
    renderWeekDays();
    renderFullWeekPlan();
    renderExerciseLogChecklist();
    updateCalDisplay();
    refreshStaticText();
  } else if (currentScreen === 'screen-onboard') {
    setOnboardStep(currentStep);
  } else if (currentScreen === 'screen-welcome') {
    refreshWelcomeText();
  }
}

function refreshWelcomeText() {
  const desc = document.getElementById('welcome-desc');
  if (desc) desc.innerHTML = t('welcome_desc').replace('\n', '<br>');
  const startBtn = document.getElementById('welcome-start-btn');
  if (startBtn) startBtn.textContent = t('welcome_start');
  const existBtn = document.getElementById('welcome-existing-btn');
  if (existBtn) existBtn.textContent = t('welcome_existing');
}

function refreshOnboardText() {
  // Labels updated dynamically in setOnboardStep
}

function refreshStaticText() {
  // Nav
  const navKeys = ['home','log','progress','plan','settings'];
  navKeys.forEach(k => {
    const el = document.querySelector(`#nav-${k} .nav-label`);
    if (el) el.textContent = t('nav_' + k);
  });

  // Section titles on home tab
  const sectionTitles = document.querySelectorAll('#tab-home .section-title');
  const homeTitles = ['today_done','this_week','latest_stats','bp_today'];
  sectionTitles.forEach((el, i) => { if (homeTitles[i]) el.textContent = t(homeTitles[i]); });

  // Stat cards
  const statLabels = document.querySelectorAll('.stat-label');
  const statKeys = ['stat_weight','stat_cal','stat_bp','stat_bmi'];
  statLabels.forEach((el, i) => { if (statKeys[i]) el.textContent = t(statKeys[i]); });

  // BP card
  const bpCard = document.querySelector('.bp-card-title');
  if (bpCard) bpCard.textContent = t('bp_avg');
  const morningAvg = document.querySelector('#bp-morning-avg')?.parentElement?.querySelector('.bp-reading-label');
  const eveningAvg = document.querySelector('#bp-evening-avg')?.parentElement?.querySelector('.bp-reading-label');
  if (morningAvg) morningAvg.textContent = t('morning_avg');
  if (eveningAvg) eveningAvg.textContent = t('evening_avg');

  // Log tabs
  const logTabs = document.querySelectorAll('.log-tab');
  const logKeys = ['log_weight','log_food','log_bp','log_exercise'];
  logTabs.forEach((el, i) => { if (logKeys[i]) el.textContent = t(logKeys[i]); });

  // Progress tabs
  const progTabs = document.querySelectorAll('.progress-tab');
  const progKeys = ['prog_weight','prog_cal','prog_bp'];
  progTabs.forEach((el, i) => { if (progKeys[i]) el.textContent = t(progKeys[i]); });

  // Settings
  const settingsSections = document.querySelectorAll('.section-title');
  // We update specific elements by ID instead
  ['set-profile-section','set-notif-section','set-data-section'].forEach((id, i) => {
    const el = document.getElementById(id);
    if (el) el.textContent = t(['settings_profile','settings_notifications','settings_data'][i]);
  });
}

const QUICK_FOODS = [
  { name: '‡πÑ‡∏Ç‡πà‡∏ï‡πâ‡∏° 1 ‡∏ü‡∏≠‡∏á', cal: 70, protein: 6 },
  { name: '‡∏Å‡∏•‡πâ‡∏ß‡∏¢', cal: 90, protein: 1 },
  { name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏™‡∏ß‡∏¢ 1 ‡∏ó‡∏±‡∏û‡∏û‡∏µ', cal: 140, protein: 3 },
  { name: '‡∏Ç‡πâ‡∏≤‡∏ß‡∏Å‡∏•‡πâ‡∏≠‡∏á 1 ‡∏ó‡∏±‡∏û‡∏û‡∏µ', cal: 120, protein: 3 },
  { name: '‡πÑ‡∏Å‡πà‡∏≠‡∏Å‡∏ô‡∏∂‡πà‡∏á 100g', cal: 165, protein: 31 },
  { name: '‡∏õ‡∏•‡∏≤‡∏ô‡∏∂‡πà‡∏á 100g', cal: 110, protein: 22 },
  { name: 'Overnight Oats', cal: 350, protein: 12 },
  { name: 'Greek Yogurt', cal: 90, protein: 10 },
  { name: 'Edamame (7-11)', cal: 100, protein: 9 },
  { name: '‡∏ï‡πâ‡∏°‡∏¢‡∏≥ 1 ‡∏ñ‡πâ‡∏ß‡∏¢', cal: 100, protein: 8 },
  { name: '‡∏ú‡∏±‡∏î‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á', cal: 90, protein: 3 },
  { name: '‡∏ó‡∏π‡∏ô‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏õ‡πã‡∏≠‡∏á', cal: 130, protein: 28 },
  { name: '‡∏ñ‡∏±‡πà‡∏ß‡∏≠‡∏±‡∏•‡∏°‡∏≠‡∏ô‡∏î‡πå 1 ‡∏Å‡∏≥‡∏°‡∏∑‡∏≠', cal: 150, protein: 6 },
  { name: '‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏•', cal: 80, protein: 0 },
  { name: '‡∏ô‡∏°‡∏ñ‡∏±‡πà‡∏ß‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏´‡∏ß‡∏≤‡∏ô', cal: 70, protein: 5 },
];

// WEEK_SCHEDULE ‚Äî day names pulled from i18n at render time
const WEEK_SCHEDULE_BASE = [
  { morning: 'üèÉ Cardio+HIIT', evening: 'üò¥ Rest',      pt: false, pilates: false },
  { morning: 'üèÉ Cardio+HIIT', evening: 'üí™ PT Gym',    pt: true,  pilates: false },
  { morning: 'üèÉ Cardio+HIIT', evening: 'üßò Pilates',   pt: false, pilates: true  },
  { morning: 'üèÉ Cardio+HIIT', evening: 'üí™ PT Gym',    pt: true,  pilates: false },
  { morning: 'üèÉ Cardio+HIIT', evening: 'üò¥ Rest',      pt: false, pilates: false },
  { morning: 'üò¥ Rest', afternoon: 'üßò Pilates', evening: 'üö∂ Walk', pt: false, pilates: true },
  { morning: 'üò¥ Rest', evening: 'üö∂ Walk 4‚Äì6km',       pt: false, pilates: false },
];

function getWeekSchedule() {
  const shorts = t('day_short');
  const fulls  = t('day_full');
  return WEEK_SCHEDULE_BASE.map((d, i) => ({ ...d, day: fulls[i], short: shorts[i] }));
}

// Alias for convenience
function WEEK_SCHEDULE_get() { return getWeekSchedule(); }

let charts = {};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG ‚Äî ‡πÉ‡∏™‡πà URL Apps Script ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxHG87VFMesL8gebR2KlyXWj_kVcjAnX1UR0Z1yb4VrdU5m3_pGcRAseLzZBo8sLh67gg/exec';

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STORAGE ‚Äî localStorage + Google Sheets sync
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

/** ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å local ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß sync ‡∏Ç‡∏∂‡πâ‡∏ô Sheets */
function saveData() {
  localStorage.setItem('pimou_profile', JSON.stringify(profile));
  localStorage.setItem('pimou_logs', JSON.stringify(logs));
}

function loadData() {
  const p = localStorage.getItem('pimou_profile');
  const l = localStorage.getItem('pimou_logs');
  if (p) profile = JSON.parse(p);
  if (l) logs = JSON.parse(l);
}

/** POST ‡πÑ‡∏õ Apps Script */
async function syncToSheets(action, data) {
  if (!APPS_SCRIPT_URL || !APPS_SCRIPT_URL) return;
  try {
    const res = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action, ...data }),
      mode: 'no-cors', // Apps Script ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ no-cors
    });
    return true;
  } catch (err) {
    console.warn('Sync failed (offline?):', err);
    return false;
  }
}

/** GET ‡∏à‡∏≤‡∏Å Apps Script */
async function fetchFromSheets(action, params = {}) {
  if (!APPS_SCRIPT_URL || !APPS_SCRIPT_URL) return null;
  try {
    const qs  = new URLSearchParams({ action, ...params }).toString();
    const res = await fetch(`${APPS_SCRIPT_URL}?${qs}`);
    return await res.json();
  } catch (err) {
    console.warn('Fetch failed:', err);
    return null;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goTo(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo(0,0);
}

function handleExistingUser() {
  loadData();
  if (profile.name) {
    // ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ ‚Üí ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
    loadApp();
  } else {
    // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‚Üí ‡∏ñ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤
    var name = prompt('‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏î Cancel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà)');
    if (name) {
      profile.name = name.trim();
      saveData();
      loadApp();
    }
  }
}

function loadApp() {
  loadData();
  goTo('screen-app');
  setTab('home');
  updateAppUI();
  renderWeekDays();
  renderTodayChecklist();
  renderFullWeekPlan();
  renderExerciseLogChecklist();
  updateWeightDisplay();
  updateCalDisplay();
  setTimeout(renderCharts, 100);
}

function setTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.log-section').forEach(s => s.classList.remove('active'));
  document.getElementById('tab-' + tab).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('nav-' + tab).classList.add('active');
  if (tab === 'progress') setTimeout(renderCharts, 100);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ONBOARDING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setOnboardStep(n) {
  currentStep = n;
  for (let i = 1; i <= 4; i++) {
    const el = document.getElementById('step-' + i);
    if (el) el.style.display = (i === n) ? 'block' : 'none';
  }
  const titles = t('step_titles');
  const steps  = t('step_labels');
  document.getElementById('onboard-title').textContent = titles[n-1];
  document.getElementById('onboard-step-label').textContent = steps[n-1];
  const dots = document.querySelectorAll('#progress-dots .dot');
  dots.forEach((d, i) => {
    d.classList.remove('active', 'done');
    d.style.width = '12px';
    if (i + 1 < n) d.classList.add('done');
    if (i + 1 === n) { d.classList.add('active'); d.style.width = '24px'; }
  });
  if (n === 3) renderExerciseScheduleOnboard();
}

function nextStep(n) {
  // Validate step 1
  if (currentStep === 1 && n > 1) {
    var name = document.getElementById('inp-name').value.trim();
    var weight = document.getElementById('inp-weight').value;
    var height = document.getElementById('inp-height').value;
    if (!name) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô'); return; }
    if (!weight) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å'); return; }
    if (!height) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á'); return; }
    saveStep1();
  }
  if (currentStep === 2 && n > 2) {
    var goalWeight = document.getElementById('inp-goal-weight').value;
    if (!goalWeight) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢'); return; }
    saveStep2();
  }
  setOnboardStep(n);
}

function saveStep1() {
  profile.name = document.getElementById('inp-name').value || '‡∏Ñ‡∏∏‡∏ì';
  profile.gender = gender;
  profile.age = parseFloat(document.getElementById('inp-age').value) || 32;
  profile.height = parseFloat(document.getElementById('inp-height').value) || 155;
  profile.weight = parseFloat(document.getElementById('inp-weight').value) || 92;
  profile.bodyFat = parseFloat(document.getElementById('inp-bf').value) || null;
  profile.conditions = { ...conditions };
  profile.meds = document.getElementById('inp-meds').value;
}

function saveStep2() {
  profile.goalWeight = parseFloat(document.getElementById('inp-goal-weight').value) || 72;
  profile.months = parseFloat(document.getElementById('inp-months').value) || 6;
  profile.activityFactor = parseFloat(document.getElementById('inp-activity').value) || 1.55;
  const customCal = document.getElementById('inp-cal-target').value;
  profile.calTarget = customCal ? parseFloat(customCal) : calcTarget();
  profile.startDate = profile.startDate || new Date().toISOString().split('T')[0];
  profile.startWeight = profile.startWeight || profile.weight;
}

function setGender(g) {
  gender = g;
  document.getElementById('btn-female').classList.toggle('active', g === 'female');
  document.getElementById('btn-male').classList.toggle('active', g === 'male');
  updateCalcs();
}

function toggleCheck(id, key) {
  const el = document.getElementById(id);
  const cb = document.getElementById('cb-' + id.replace('chk-', ''));
  conditions[key] = !conditions[key];
  el.classList.toggle('checked', conditions[key]);
  cb.textContent = conditions[key] ? '‚úì' : '';
}

function calcBMR() {
  const w = parseFloat(document.getElementById('inp-weight')?.value) || profile.weight || 92;
  const h = parseFloat(document.getElementById('inp-height')?.value) || profile.height || 155;
  const a = parseFloat(document.getElementById('inp-age')?.value) || profile.age || 32;
  const g = gender || profile.gender || 'female';
  if (g === 'female') return (10 * w) + (6.25 * h) - (5 * a) - 161;
  return (10 * w) + (6.25 * h) - (5 * a) + 5;
}

function calcTarget() {
  const af = parseFloat(document.getElementById('inp-activity')?.value) || profile.activityFactor || 1.55;
  const tdee = calcBMR() * af;
  return Math.round(tdee - 600);
}

function updateCalcs() {
  const w = parseFloat(document.getElementById('inp-weight')?.value) || 0;
  const h = parseFloat(document.getElementById('inp-height')?.value) || 0;
  const gw = parseFloat(document.getElementById('inp-goal-weight')?.value) || 0;
  const months = parseFloat(document.getElementById('inp-months')?.value) || 6;

  if (!w || !h) return;
  const bmi = (w / Math.pow(h / 100, 2)).toFixed(1);
  const bmr = Math.round(calcBMR());
  const af = parseFloat(document.getElementById('inp-activity')?.value) || 1.55;
  const tdee = Math.round(bmr * af);
  const target = Math.round(tdee - 600);
  const deficit = tdee - target;
  const weeklyLoss = ((deficit * 7) / 7700).toFixed(2);

  const bmiEl = document.getElementById('calc-bmi');
  const bmrEl = document.getElementById('calc-bmr');
  const tdeeEl = document.getElementById('calc-tdee');
  const targetEl = document.getElementById('calc-target');
  const lossEl = document.getElementById('calc-loss-rate');

  if (bmiEl) {
    let bmiCat = bmi > 30 ? 'üî¥ Obese' : bmi > 25 ? 'üü° Overweight' : 'üü¢ Normal';
    bmiEl.textContent = bmi + ' ' + bmiCat;
    bmrEl.textContent = bmr.toLocaleString() + ' kcal';
    tdeeEl.textContent = tdee.toLocaleString() + ' kcal';
    targetEl.textContent = target.toLocaleString() + ' kcal';
    lossEl.textContent = weeklyLoss + ' kg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
  }

  const calTargetEl = document.getElementById('inp-cal-target');
  if (calTargetEl && !calTargetEl.value) calTargetEl.placeholder = target.toString();
}

function renderExerciseScheduleOnboard() {
  const wrap = document.getElementById('exercise-schedule');
  if (!wrap) return;
  wrap.innerHTML = getWeekSchedule().map(function(d, i) {
    var h = '<div style="background:var(--card);border-radius:14px;border:1.5px solid var(--border);padding:14px 16px;margin-bottom:8px;">';
    h += '<div style="font-size:13px;font-weight:700;color:var(--green-700);margin-bottom:6px;">' + d.day + '</div>';
    h += '<div style="font-size:12px;color:var(--text-mid);">üåÖ ‡πÄ‡∏ä‡πâ‡∏≤: ' + d.morning + '</div>';
    if (d.afternoon) h += '<div style="font-size:12px;color:var(--text-mid);">‚òÄÔ∏è ‡∏ö‡πà‡∏≤‡∏¢: ' + d.afternoon + '</div>';
    h += '<div style="font-size:12px;color:var(--text-mid);">üåÜ ‡πÄ‡∏¢‡πá‡∏ô: ' + d.evening + '</div>';
    h += '</div>';
    return h;
  }).join('');
}

function finishOnboard() {
  saveStep1();
  saveStep2();
  profile.lineToken = document.getElementById('inp-line-token').value;
  profile.lineName = document.getElementById('inp-line-name').value || profile.name;
  profile.notifTimes = {
    morning: document.getElementById('notif-morning').value || '06:00',
    noon: document.getElementById('notif-noon').value || '12:00',
    evening: document.getElementById('notif-evening').value || '18:00',
    night: document.getElementById('notif-night').value || '21:00',
  };
  // Ensure critical fields always set
  profile.startDate = profile.startDate || new Date().toISOString().split('T')[0];
  profile.startWeight = profile.startWeight || profile.weight;
  saveData();
  syncToSheets('save_profile', profile);
  loadApp();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APP UI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAppUI() {
  const hour = new Date().getHours();
  const greet = hour < 12 ? t('good_morning') : hour < 17 ? t('good_afternoon') : t('good_evening');
  document.getElementById('app-greeting').textContent = greet;
  document.getElementById('app-name').textContent = profile.name || '‡∏Ñ‡∏∏‡∏ì';

  const sw = profile.startWeight || profile.weight || 92;
  const gw = profile.goalWeight || 72;
  const cw = getLatestWeight() || sw;
  const totalNeeded = sw - gw;
  const lost = sw - cw;
  const pct = Math.max(0, Math.min(100, Math.round((lost / totalNeeded) * 100)));

  document.getElementById('goal-bar-fill').style.width = pct + '%';
  document.getElementById('bar-label-right').textContent = pct + '%';

  const start = profile.startDate ? new Date(profile.startDate) : new Date();
  const today = new Date();
  const dayNum = Math.floor((today - start) / (1000 * 60 * 60 * 24)) + 1;
  document.getElementById('tag-day').textContent = 'Day ' + dayNum;
  document.getElementById('tag-left').textContent = '‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + Math.max(0, (cw - gw).toFixed(1)) + ' kg';
  document.getElementById('tag-cal').textContent = '‡πÄ‡∏õ‡πâ‡∏≤ ' + (profile.calTarget || 1850) + ' kcal';

  // Stats
  const bmi = cw && profile.height ? (cw / Math.pow(profile.height/100, 2)).toFixed(1) : '-';
  document.getElementById('stat-weight').textContent = cw ? cw.toFixed(1) : '-';
  document.getElementById('stat-bmi').textContent = bmi;

  const bmiNum = parseFloat(bmi);
  let bmiCat = '-'; let bmiClass = 'ok';
  if (bmiNum > 30) { bmiCat = 'Obese'; bmiClass = 'up'; }
  else if (bmiNum > 25) { bmiCat = 'Overweight'; bmiClass = 'up'; }
  else if (bmiNum >= 18.5) { bmiCat = 'Normal'; bmiClass = 'down'; }
  document.getElementById('stat-bmi-cat').textContent = bmiCat;
  document.getElementById('stat-bmi-cat').className = 'stat-delta ' + bmiClass;

  // Update settings display
  if (profile.name) {
    const settingProfile = document.getElementById('set-profile-val');
    if (settingProfile) settingProfile.textContent = profile.name + ', ' + (profile.age||'-') + '‡∏õ‡∏µ';
    const settingGoal = document.getElementById('set-goal-val');
    if (settingGoal) settingGoal.textContent = '‡πÄ‡∏õ‡πâ‡∏≤ ' + (profile.goalWeight||'-') + ' kg';
    if (profile.lineToken) {
      const settingLine = document.getElementById('set-line-val');
      if (settingLine) settingLine.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß ‚úì';
    }
  }
}

function getLatestWeight() {
  if (!logs.weights || logs.weights.length === 0) return profile.weight || null;
  return logs.weights[logs.weights.length - 1].weight;
}

function getTodayKey() {
  return new Date().toISOString().split('T')[0];
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TODAY CHECKLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTodayChecklist() {
  const today = new Date().getDay(); // 0=Sun
  const dayMap = [6,0,1,2,3,4,5]; // Sun=6, Mon=0...
  const dayIdx = dayMap[today];
  const sched = getWeekSchedule()[dayIdx];
  const key = getTodayKey();
  const todayEx = logs.exercise[key] || {};

  const items = [];
  if (sched.morning.includes('Cardio')) items.push({ id: 'cardio', name: 'Cardio + HIIT', time: '‡πÄ‡∏ä‡πâ‡∏≤ 30 ‡∏ô‡∏≤‡∏ó‡∏µ', icon: 'üèÉ' });
  if (sched.pt) items.push({ id: 'pt', name: 'PT at Gym', time: '‡πÄ‡∏¢‡πá‡∏ô 60 ‡∏ô‡∏≤‡∏ó‡∏µ', icon: 'üí™' });
  if (sched.pilates) items.push({ id: 'pilates', name: 'Pilates', time: sched.afternoon ? '‡∏ö‡πà‡∏≤‡∏¢' : '‡πÄ‡∏¢‡πá‡∏ô', icon: 'üßò' });
  if (sched.evening.includes('‡πÄ‡∏î‡∏¥‡∏ô')) items.push({ id: 'walk', name: '‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏ß‡∏ô', time: '‡πÄ‡∏¢‡πá‡∏ô', icon: 'üö∂' });
  items.push({ id: 'bp_morning', name: '‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏ä‡πâ‡∏≤', time: '‡∏Å‡πà‡∏≠‡∏ô 9 ‡πÇ‡∏°‡∏á', icon: '‚ù§Ô∏è' });
  items.push({ id: 'bp_evening', name: '‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÄ‡∏¢‡πá‡∏ô', time: '‡∏Å‡πà‡∏≠‡∏ô 2 ‡∏ó‡∏∏‡πà‡∏°', icon: '‚ù§Ô∏è' });
  items.push({ id: 'food_log', name: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏≤‡∏´‡∏≤‡∏£', time: '‡∏ó‡∏∏‡∏Å‡∏°‡∏∑‡πâ‡∏≠', icon: 'üçΩÔ∏è' });

  const wrap = document.getElementById('today-checklist');
  wrap.innerHTML = items.map(it => {
    const done = todayEx[it.id];
    var html = '<div class="check-item ' + (done?'done':'') + '" id="ci-' + it.id + '" onclick="toggleChecklist(\'' + it.id + '\')">';
    html += '<div class="check-circle">' + (done ? '‚úì' : '') + '</div>';
    html += '<div class="check-info">';
    html += '<div class="check-name">' + it.icon + ' ' + it.name + '</div>';
    html += '<div class="check-time">' + it.time + '</div>';
    html += '</div></div>';
    return html;
  }).join('');
}

function toggleChecklist(id) {
  const key = getTodayKey();
  if (!logs.exercise[key]) logs.exercise[key] = {};
  logs.exercise[key][id] = !logs.exercise[key][id];
  saveData();
  renderTodayChecklist();
  showToast(logs.exercise[key][id] ? '‚úì ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!' : '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEEK DAYS (HOME)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderWeekDays() {
  const wrap = document.getElementById('week-days-home');
  if (!wrap) return;
  const today = new Date();
  const todayDay = today.getDay();
  const dayNames = ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'];

  wrap.innerHTML = getWeekSchedule().map((d, i) => {
    const jsDay = [1,2,3,4,5,6,0][i]; // Mon=1...Sun=0
    const isToday = jsDay === todayDay;
    const date = new Date(today);
    date.setDate(today.getDate() + (i - ([1,2,3,4,5,6,0].indexOf(todayDay))));
    const icons = [];
    if (d.morning.includes('Cardio')) icons.push('üèÉ');
    if (d.pt) icons.push('üí™');
    if (d.pilates) icons.push('üßò');
    if (d.evening.includes('‡πÄ‡∏î‡∏¥‡∏ô')) icons.push('üö∂');
    var dayHtml = '<div class="day-card ' + (isToday?'today':'') + '">';
    dayHtml += '<div class="day-name">' + d.short + '</div>';
    dayHtml += '<div class="day-num">' + date.getDate() + '</div>';
    dayHtml += '<div class="day-icons">' + icons.map(function(ic){ return '<span class="day-icon">' + ic + '</span>'; }).join('') + '</div>';
    if (isToday) dayHtml += '<div class="day-dot"></div>';
    dayHtml += '</div>';
    return dayHtml;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FULL WEEK PLAN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderFullWeekPlan() {
  const wrap = document.getElementById('full-week-plan');
  if (!wrap) return;
  wrap.innerHTML = getWeekSchedule().map(function(d) {
    var h = '<div style="background:var(--card);border-radius:16px;border:1.5px solid var(--border);padding:16px;margin-bottom:10px;">';
    h += '<div style="font-size:14px;font-weight:700;color:var(--green-700);margin-bottom:8px;">' + d.day + '</div>';
    h += '<div style="font-size:12px;color:var(--text-mid);margin-bottom:3px;">üåÖ ‡πÄ‡∏ä‡πâ‡∏≤ ‚Äî ' + d.morning + '</div>';
    if (d.afternoon) h += '<div style="font-size:12px;color:var(--text-mid);margin-bottom:3px;">‚òÄÔ∏è ‡∏ö‡πà‡∏≤‡∏¢ ‚Äî ' + d.afternoon + '</div>';
    h += '<div style="font-size:12px;color:var(--text-mid);">üåÜ ‡πÄ‡∏¢‡πá‡∏ô ‚Äî ' + d.evening + '</div>';
    h += '</div>';
    return h;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EXERCISE LOG CHECKLIST
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderExerciseLogChecklist() {
  var wrap = document.getElementById('exercise-checklist-log');
  if (!wrap) return;
  var today = new Date().getDay();
  var dayMap = [6,0,1,2,3,4,5];
  var sched = getWeekSchedule()[dayMap[today]];
  var key = getTodayKey();
  var todayEx = logs.exercise[key] || {};

  var items = [];
  if (sched.morning.includes('Cardio')) items.push({ id: 'cardio', name: 'Cardio + HIIT', icon: 'üèÉ', defaultMin: 30 });
  if (sched.pt)      items.push({ id: 'pt',      name: 'PT at Gym',    icon: 'üí™', defaultMin: 60 });
  if (sched.pilates) items.push({ id: 'pilates',  name: 'Pilates',      icon: 'üßò', defaultMin: 50 });
  if (sched.evening.includes('‡πÄ‡∏î‡∏¥‡∏ô')) items.push({ id: 'walk', name: '‡πÄ‡∏î‡∏¥‡∏ô‡∏™‡∏ß‡∏ô', icon: 'üö∂', defaultMin: 30 });

  var html = '';
  items.forEach(function(it) {
    var done  = todayEx[it.id];
    var dur   = todayEx[it.id + '_min']  || '';
    var hr    = todayEx[it.id + '_hr']   || '';
    var cal   = todayEx[it.id + '_cal']  || '';

    html += '<div style="background:var(--card);border-radius:16px;border:1.5px solid ' + (done ? 'var(--green-500)' : 'var(--border)') + ';padding:14px 16px;margin-bottom:10px;transition:all 0.2s;">';
    
    // Header row ‚Äî checkbox + name
    html += '<div style="display:flex;align-items:center;gap:12px;cursor:pointer;" onclick="toggleChecklist(\'' + it.id + '\');renderExerciseLogChecklist()">';
    html += '<div style="width:24px;height:24px;border-radius:50%;border:2px solid ' + (done ? 'var(--green-500)' : 'var(--border)') + ';background:' + (done ? 'var(--green-500)' : 'transparent') + ';display:flex;align-items:center;justify-content:center;flex-shrink:0;">';
    html += done ? '<span style="color:white;font-size:13px;font-weight:700;">‚úì</span>' : '';
    html += '</div>';
    html += '<div style="flex:1;">';
    html += '<div style="font-size:14px;font-weight:700;color:' + (done ? 'var(--green-700)' : 'var(--text)') + ';">' + it.icon + ' ' + it.name + '</div>';
    html += '</div>';
    html += '<div style="font-size:11px;color:' + (done ? 'var(--green-600)' : 'var(--text-soft)') + ';font-weight:600;">' + (done ? '‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úì' : '‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢') + '</div>';
    html += '</div>';

    // Detail inputs row (always visible when done, collapsed when not)
    html += '<div style="margin-top:' + (done ? '12' : '0') + 'px;overflow:hidden;max-height:' + (done ? '200px' : '0') + ';transition:max-height 0.3s ease;">';
    html += '<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding-top:4px;">';
    
    // Duration
    html += '<div style="background:var(--green-50);border-radius:10px;padding:8px;text-align:center;">';
    html += '<div style="font-size:10px;color:var(--text-soft);margin-bottom:3px;">‚è± ‡∏ô‡∏≤‡∏ó‡∏µ</div>';
    html += '<input type="number" placeholder="' + it.defaultMin + '" value="' + dur + '" ';
    html += 'onchange="saveActivityDetail(\'' + it.id + '\',\'min\',this.value)" ';
    html += 'style="width:100%;border:none;background:transparent;font-size:16px;font-weight:700;text-align:center;color:var(--green-700);outline:none;">';
    html += '</div>';
    
    // Heart Rate
    html += '<div style="background:var(--green-50);border-radius:10px;padding:8px;text-align:center;">';
    html += '<div style="font-size:10px;color:var(--text-soft);margin-bottom:3px;">‚ù§Ô∏è HR ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>';
    html += '<input type="number" placeholder="140" value="' + hr + '" ';
    html += 'onchange="saveActivityDetail(\'' + it.id + '\',\'hr\',this.value)" ';
    html += 'style="width:100%;border:none;background:transparent;font-size:16px;font-weight:700;text-align:center;color:var(--green-700);outline:none;">';
    html += '</div>';
    
    // Cal burn this activity
    html += '<div style="background:var(--green-50);border-radius:10px;padding:8px;text-align:center;">';
    html += '<div style="font-size:10px;color:var(--text-soft);margin-bottom:3px;">üî• Cal</div>';
    html += '<input type="number" placeholder="?" value="' + cal + '" ';
    html += 'onchange="saveActivityDetail(\'' + it.id + '\',\'cal\',this.value);updateTotalCalBurn()" ';
    html += 'style="width:100%;border:none;background:transparent;font-size:16px;font-weight:700;text-align:center;color:var(--green-700);outline:none;">';
    html += '</div>';
    
    html += '</div>';
    html += '</div>';
    html += '</div>';
  });

  wrap.innerHTML = html;
}

function saveActivityDetail(activityId, field, value) {
  var key = getTodayKey();
  if (!logs.exercise[key]) logs.exercise[key] = {};
  logs.exercise[key][activityId + '_' + field] = parseFloat(value) || 0;
  saveData();
}

function updateTotalCalBurn() {
  // ‡∏£‡∏ß‡∏° cal ‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å activity ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  var key = getTodayKey();
  var ex = logs.exercise[key] || {};
  var total = 0;
  ['cardio','pt','pilates','walk'].forEach(function(id) {
    total += ex[id + '_cal'] || 0;
  });
  if (total > 0) {
    var burnEl = document.getElementById('inp-cal-burn');
    if (burnEl) { burnEl.value = total; updateCalBurnDisplay(); }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LOG TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setLogTab(tab) {
  currentLogTab = tab;
  ['weight','food','bp','exercise'].forEach(function(t) {
    document.getElementById('log-' + t).style.display = t === tab ? 'block' : 'none';
  });
  document.querySelectorAll('.log-tab').forEach(function(btn, i) {
    btn.classList.toggle('active', ['weight','food','bp','exercise'][i] === tab);
  });
  // Pre-fill steps + calBurn from saved data
  if (tab === 'exercise') {
    var key = getTodayKey();
    var ex = logs.exercise[key] || {};
    var stepsEl = document.getElementById('inp-steps');
    var burnEl = document.getElementById('inp-cal-burn');
    if (stepsEl && ex.steps) stepsEl.value = ex.steps;
    if (burnEl && ex.calBurn) { burnEl.value = ex.calBurn; updateCalBurnDisplay(); }
    renderExerciseLogChecklist();
  }
  if (tab === 'food') updateCalDisplay();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WEIGHT SAVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function saveWeight() {
  const w = parseFloat(document.getElementById('log-weight-input').value);
  if (!w) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å'); return; }
  const entry = {
    date: getTodayKey(),
    weight: w,
    waist: parseFloat(document.getElementById('log-waist-input').value) || null,
    hip: parseFloat(document.getElementById('log-hip-input').value) || null,
    bodyFat: parseFloat(document.getElementById('log-bf-input').value) || null,
  };
  logs.weights = logs.weights.filter(e => e.date !== entry.date);
  logs.weights.push(entry);
  logs.weights.sort((a,b) => a.date.localeCompare(b.date));
  saveData();
  updateAppUI();
  updateWeightDisplay();
  showToast('‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...');
  // Sync ‡πÑ‡∏õ Google Sheets
  syncToSheets('save_weight', entry).then(ok => {
    showToast(ok ? '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + sync Sheets ‡πÅ‡∏•‡πâ‡∏ß! üìä' : '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (offline)');
  });
  document.getElementById('log-weight-input').value = '';
}

function updateWeightDisplay() {
  const cw = getLatestWeight();
  const gw = profile.goalWeight || 72;
  const sw = profile.startWeight || profile.weight || 92;
  document.getElementById('disp-current-weight').textContent = cw ? cw.toFixed(1) : '-';
  document.getElementById('disp-goal-weight').textContent = gw;
  document.getElementById('disp-lost').textContent = cw ? Math.max(0, sw - cw).toFixed(1) : '-';

  document.getElementById('stat-weight').textContent = cw ? cw.toFixed(1) : '-';
  if (logs.weights.length >= 2) {
    const prev = logs.weights[logs.weights.length - 2].weight;
    const diff = (cw - prev).toFixed(1);
    const el = document.getElementById('stat-weight-delta');
    el.textContent = (diff > 0 ? '+' : '') + diff + ' kg';
    el.className = 'stat-delta ' + (diff <= 0 ? 'down' : 'up');
  }

  const bmi = cw && profile.height ? (cw / Math.pow(profile.height/100, 2)).toFixed(1) : '-';
  document.getElementById('stat-bmi').textContent = bmi;
  document.getElementById('ws-start').textContent = sw + ' kg';
  document.getElementById('ws-current').textContent = (cw || sw) + ' kg';
  document.getElementById('ws-lost').textContent = cw ? (sw - cw).toFixed(1) + ' kg' : '-';
  document.getElementById('ws-bmi').textContent = bmi;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BP SAVE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function checkBP(fieldId) {
  const val = parseFloat(document.getElementById(fieldId).value);
  const prefix = fieldId.replace('-sys','');
  const warnId = 'warn-' + prefix.replace('bp-','');
  const warn = document.getElementById(warnId);
  if (warn && val > 140) warn.classList.add('show');
  else if (warn) warn.classList.remove('show');
}

function saveBP() {
  const getVal = (id) => parseFloat(document.getElementById(id)?.value) || null;
  const entry = {
    date: getTodayKey(),
    m1: { sys: getVal('bp-m1-sys'), dia: getVal('bp-m1-dia'), pul: getVal('bp-m1-pul') },
    m2: { sys: getVal('bp-m2-sys'), dia: getVal('bp-m2-dia'), pul: getVal('bp-m2-pul') },
    e1: { sys: getVal('bp-e1-sys'), dia: getVal('bp-e1-dia'), pul: getVal('bp-e1-pul') },
    e2: { sys: getVal('bp-e2-sys'), dia: getVal('bp-e2-dia'), pul: getVal('bp-e2-pul') },
  };
  if (!logs.bp) logs.bp = [];
  logs.bp = logs.bp.filter(e => e.date !== entry.date);
  logs.bp.push(entry);
  logs.bp.sort((a,b) => a.date.localeCompare(b.date));
  saveData();
  updateBPDisplay(entry);
  showToast('‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...');
  syncToSheets('save_bp', entry).then(ok => {
    showToast(ok ? '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô + sync ‡πÅ‡∏•‡πâ‡∏ß! üìä' : '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (offline)');
  });
}

function updateBPDisplay(entry) {
  const avg = (a, b) => (a && b) ? Math.round((a + b) / 2) : (a || b || '-');
  const mSys = avg(entry?.m1?.sys, entry?.m2?.sys);
  const mDia = avg(entry?.m1?.dia, entry?.m2?.dia);
  const eSys = avg(entry?.e1?.sys, entry?.e2?.sys);
  const eDia = avg(entry?.e1?.dia, entry?.e2?.dia);

  document.getElementById('bp-morning-avg').textContent = mSys !== '-' ? mSys + '/' + mDia : '‚Äî/‚Äî';
  document.getElementById('bp-evening-avg').textContent = eSys !== '-' ? eSys + '/' + eDia : '‚Äî/‚Äî';

  const allSys = [entry?.m1?.sys, entry?.m2?.sys, entry?.e1?.sys, entry?.e2?.sys].filter(Boolean);
  const allDia = [entry?.m1?.dia, entry?.m2?.dia, entry?.e1?.dia, entry?.e2?.dia].filter(Boolean);
  if (allSys.length) {
    const avgSys = Math.round(allSys.reduce((a,b)=>a+b,0)/allSys.length);
    const avgDia = Math.round(allDia.reduce((a,b)=>a+b,0)/allDia.length);
    document.getElementById('stat-bp').textContent = avgSys + '/' + avgDia;
    document.getElementById('stat-bp-status').textContent = avgSys > 140 ? '‚ö†Ô∏è ‡∏™‡∏π‡∏á' : avgSys > 130 ? '‚ö†Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡∏á' : '‚úì ‡∏õ‡∏Å‡∏ï‡∏¥';
    document.getElementById('stat-bp-status').className = 'stat-delta ' + (avgSys > 130 ? 'up' : 'down');
    document.getElementById('avg-sys').textContent = avgSys + ' mmHg';
    document.getElementById('avg-dia').textContent = avgDia + ' mmHg';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOOD LOG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let todayFoods = { breakfast: [], lunch: [], dinner: [], snack: [] };

function openFoodModal(meal) {
  currentFoodMeal = meal;
  document.getElementById('food-modal').classList.add('open');
  document.getElementById('food-name-input').value = '';
  document.getElementById('food-cal-input').value = '';
  document.getElementById('food-protein-input').value = '';
  const qf = document.getElementById('quick-foods-list');
  qf.innerHTML = QUICK_FOODS.map(function(f) {
    return '<div class="quick-food" onclick="quickAddFood(\'' + f.name + '\',' + f.cal + ',' + f.protein + ')">' + f.name + ' <span style="opacity:0.7">' + f.cal + '</span></div>';
  }).join('');
}

function closeFoodModal() {
  document.getElementById('food-modal').classList.remove('open');
}

function quickAddFood(name, cal, protein) {
  document.getElementById('food-name-input').value = name;
  document.getElementById('food-cal-input').value = cal;
  document.getElementById('food-protein-input').value = protein;
}

function addFood() {
  const name = document.getElementById('food-name-input').value;
  const cal = parseFloat(document.getElementById('food-cal-input').value) || 0;
  const protein = parseFloat(document.getElementById('food-protein-input').value) || 0;
  if (!name) { showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π'); return; }

  const key = getTodayKey();
  if (!logs.food[key]) logs.food[key] = { breakfast: [], lunch: [], dinner: [], snack: [] };
  logs.food[key][currentFoodMeal].push({ name, cal, protein });
  saveData();
  updateCalDisplay();
  closeFoodModal();
  showToast('‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏•‡πâ‡∏ß!');
  // Sync food ‡∏ó‡∏±‡πâ‡∏á‡∏ß‡∏±‡∏ô‡πÑ‡∏õ Sheets
  syncToSheets('save_food', {
    date: key,
    meals: logs.food[key],
    calTarget: profile.calTarget || 1850,
  });
}

function updateCalDisplay() {
  var key = getTodayKey();
  var dayFood = logs.food[key] || { breakfast: [], lunch: [], dinner: [], snack: [] };
  var meals = ['breakfast','lunch','dinner','snack'];
  var calIds = { breakfast: 'cal-breakfast', lunch: 'cal-lunch', dinner: 'cal-dinner', snack: 'cal-snack' };
  var itemIds = { breakfast: 'items-breakfast', lunch: 'items-lunch', dinner: 'items-dinner', snack: 'items-snack' };

  var total = 0;
  meals.forEach(function(m) {
    var items = dayFood[m] || [];
    var mCal = items.reduce(function(s,f){ return s + f.cal; }, 0);
    total += mCal;
    var calEl = document.getElementById(calIds[m]);
    if (calEl) calEl.textContent = mCal + ' kcal';
    var itemEl = document.getElementById(itemIds[m]);
    if (itemEl) {
      itemEl.innerHTML = items.map(function(f) {
        return '<div class="meal-item"><span class="meal-item-name">' + f.name + '</span><span class="meal-item-cal">' + f.cal + ' kcal</span></div>';
      }).join('');
    }
  });

  // ‡∏´‡∏±‡∏Å Cal ‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏≤‡∏ú‡∏•‡∏≤‡∏ç‡∏à‡∏≤‡∏Å‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢
  var calBurn = (logs.exercise[key] && logs.exercise[key].calBurn) || 0;
  var steps = (logs.exercise[key] && logs.exercise[key].steps) || 0;
  var net = total - calBurn;

  var target = profile.calTarget || 1850;
  var remain = target - net;
  var pct = Math.min(100, Math.round((net / target) * 100));

  var calEaten = document.getElementById('cal-eaten');
  var calRemain = document.getElementById('cal-remain');
  var calGoalDisp = document.getElementById('cal-goal-disp');
  var calBar = document.getElementById('cal-bar');
  if (calEaten) calEaten.textContent = total;
  if (calRemain) calRemain.textContent = Math.max(0, remain);
  if (calGoalDisp) calGoalDisp.textContent = target;
  if (calBar) {
    calBar.style.width = pct + '%';
    calBar.className = 'cal-fill' + (pct > 105 ? ' over' : '');
  }

  // ‡πÅ‡∏™‡∏î‡∏á cal burn + steps ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  var statCal = document.getElementById('stat-cal');
  var statCalStatus = document.getElementById('stat-cal-status');
  if (statCal) statCal.textContent = net || total || '-';
  if (statCalStatus) {
    var statusText = '';
    if (calBurn > 0) statusText = '‡πÄ‡∏ú‡∏≤ -' + calBurn + (remain >= 0 ? ' | ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + remain : ' | ‡πÄ‡∏Å‡∏¥‡∏ô ' + Math.abs(remain));
    else statusText = total ? (remain >= 0 ? '‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ' + remain : '‡πÄ‡∏Å‡∏¥‡∏ô ' + Math.abs(remain)) : '-';
    statCalStatus.textContent = statusText;
    statCalStatus.className = 'stat-delta ' + (remain >= 0 ? 'ok' : 'up');
  }

  // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πâ‡∏≤‡∏ß‡∏ö‡∏ô‡∏´‡∏ô‡πâ‡∏≤ home ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  var stepsEl = document.getElementById('stat-steps');
  if (stepsEl) {
    stepsEl.textContent = steps ? steps.toLocaleString() : '-';
    var stepsStatus = document.getElementById('stat-steps-status');
    if (stepsStatus) {
      stepsStatus.textContent = steps >= 10000 ? '‚úì ‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß!' : steps >= 7000 ? '‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏Ñ‡∏£‡∏ö' : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö';
      stepsStatus.className = 'stat-delta ' + (steps >= 10000 ? 'down' : steps >= 7000 ? 'ok' : 'up');
    }
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RPE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setRPE(n) {
  currentRPE = n;
  [1,2,3,4].forEach(i => document.getElementById('rpe-' + i).classList.toggle('active', i === n));
}

function saveExercise() {
  var key = getTodayKey();
  if (!logs.exercise[key]) logs.exercise[key] = {};
  logs.exercise[key].rpe = currentRPE;
  logs.exercise[key].note = document.getElementById('exercise-note').value;
  // Steps & cal burn
  var steps = parseInt(document.getElementById('inp-steps').value) || 0;
  var calBurn = parseInt(document.getElementById('inp-cal-burn').value) || 0;
  logs.exercise[key].steps = steps;
  logs.exercise[key].calBurn = calBurn;
  saveData();
  // Update cal display to reflect burn
  updateCalDisplay();
  showToast('‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á sync...');
  syncToSheets('save_exercise', {
    date: key,
    steps: steps,
    calBurn: calBurn,
    rpe: currentRPE,
    note: logs.exercise[key].note,
    cardio: !!logs.exercise[key].cardio,
    pt: !!logs.exercise[key].pt,
    pilates: !!logs.exercise[key].pilates,
    walk: !!logs.exercise[key].walk,
    bp_morning: !!logs.exercise[key].bp_morning,
    bp_evening: !!logs.exercise[key].bp_evening,
    food_log: !!logs.exercise[key].food_log,
  }).then(ok => {
    showToast(ok ? '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å + sync ‡πÅ‡∏•‡πâ‡∏ß! üìä' : '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß (offline)');
  });
}

function setCalBurn(val) {
  document.getElementById('inp-cal-burn').value = val;
  updateCalBurnDisplay();
}

function updateCalBurnDisplay() {
  var burn = parseInt(document.getElementById('inp-cal-burn').value) || 0;
  var hint = document.getElementById('cal-burn-hint');
  if (hint) {
    hint.textContent = burn > 0 ? 'Cal ‡∏™‡∏∏‡∏ó‡∏ò‡∏¥ -' + burn + ' kcal' : '‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á';
    hint.style.color = burn > 0 ? 'var(--green-700)' : '';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROGRESS TAB
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function setProgressTab(tab) {
  currentProgressTab = tab;
  ['weight','cal','bp'].forEach(t => {
    document.getElementById('prog-' + t).style.display = t === tab ? 'block' : 'none';
  });
  document.querySelectorAll('.progress-tab').forEach((btn, i) => {
    btn.classList.toggle('active', ['weight','cal','bp'][i] === tab);
  });
  setTimeout(renderCharts, 50);
}

function setChartRange(range) {
  document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');
  renderCharts();
}

function renderCharts() {
  renderWeightChart();
  renderCalChart();
  renderBPChart();
}

function renderWeightChart() {
  const canvas = document.getElementById('chart-weight');
  if (!canvas || !canvas.offsetParent) return;
  const data = logs.weights.slice(-8);
  const labels = data.map(d => d.date.slice(5));
  const values = data.map(d => d.weight);
  const goal = Array(labels.length).fill(profile.goalWeight || 72);

  if (charts.weight) charts.weight.destroy();
  charts.weight = new Chart(canvas, {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å', data: values, borderColor: '#2d7a56', backgroundColor: 'rgba(45,122,86,0.1)', borderWidth: 2.5, pointRadius: 4, pointBackgroundColor: '#2d7a56', fill: true, tension: 0.3 },
        { label: '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢', data: goal, borderColor: '#00e676', borderDash: [5,5], borderWidth: 1.5, pointRadius: 0 },
      ]
    },
    options: { plugins: { legend: { display: false } }, scales: { y: { ticks: { font: { family: 'Poppins', size: 10 } }, grid: { color: '#e0f4ec' } }, x: { ticks: { font: { family: 'Poppins', size: 10 } }, grid: { display: false } } } }
  });
}

function renderCalChart() {
  const canvas = document.getElementById('chart-cal');
  if (!canvas || !canvas.offsetParent) return;
  const days = 7;
  const labels = [];
  const values = [];
  const target = profile.calTarget || 1850;
  for (let i = days-1; i >= 0; i--) {
    const d = new Date(); d.setDate(d.getDate() - i);
    const key = d.toISOString().split('T')[0];
    labels.push(key.slice(5));
    const dayFood = logs.food[key];
    const total = dayFood ? Object.values(dayFood).flat().reduce((s,f)=>s+f.cal,0) : 0;
    values.push(total);
  }
  if (charts.cal) charts.cal.destroy();
  charts.cal = new Chart(canvas, {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { data: values, backgroundColor: values.map(v => v > target ? '#ff6b6b' : '#2d7a56'), borderRadius: 6 },
        { type: 'line', data: Array(days).fill(target), borderColor: '#00e676', borderDash: [4,4], borderWidth: 1.5, pointRadius: 0 }
      ]
    },
    options: { plugins: { legend: { display: false } }, scales: { y: { ticks: { font: { family: 'Poppins', size: 10 } } }, x: { ticks: { font: { family: 'Poppins', size: 10 } }, grid: { display: false } } } }
  });
}

function renderBPChart() {
  const canvas = document.getElementById('chart-bp');
  if (!canvas || !canvas.offsetParent) return;
  const data = logs.bp ? logs.bp.slice(-14) : [];
  const labels = data.map(d => d.date.slice(5));
  const sysVals = data.map(e => {
    const s = [e.m1?.sys, e.m2?.sys, e.e1?.sys, e.e2?.sys].filter(Boolean);
    return s.length ? Math.round(s.reduce((a,b)=>a+b,0)/s.length) : null;
  });
  const diaVals = data.map(e => {
    const s = [e.m1?.dia, e.m2?.dia, e.e1?.dia, e.e2?.dia].filter(Boolean);
    return s.length ? Math.round(s.reduce((a,b)=>a+b,0)/s.length) : null;
  });

  if (charts.bp) charts.bp.destroy();
  charts.bp = new Chart(canvas, {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'Systolic', data: sysVals, borderColor: '#ff6b6b', backgroundColor: 'rgba(255,107,107,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 },
        { label: 'Diastolic', data: diaVals, borderColor: '#2d7a56', backgroundColor: 'rgba(45,122,86,0.1)', borderWidth: 2, pointRadius: 3, fill: false, tension: 0.3 },
        { label: '‡πÄ‡∏õ‡πâ‡∏≤ Sys', data: Array(labels.length).fill(120), borderColor: '#ff6b6b', borderDash: [4,4], borderWidth: 1, pointRadius: 0 },
      ]
    },
    options: { plugins: { legend: { labels: { font: { family: 'Poppins', size: 10 }, boxWidth: 10 } } }, scales: { y: { min: 60, ticks: { font: { family: 'Poppins', size: 10 } } }, x: { ticks: { font: { family: 'Poppins', size: 10 } }, grid: { display: false } } } }
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

function exportCSV() {
  let csv = 'Date,Weight,Waist,Hip,BodyFat,BP_M1_Sys,BP_M1_Dia,BP_E1_Sys,BP_E1_Dia,Cal_Total\n';
  const allDates = [...new Set([
    ...logs.weights.map(w => w.date),
    ...(logs.bp||[]).map(b => b.date),
    ...Object.keys(logs.food||{})
  ])].sort();

  allDates.forEach(d => {
    const w = logs.weights.find(e => e.date === d) || {};
    const bp = (logs.bp||[]).find(e => e.date === d) || {};
    const food = logs.food[d];
    const calTotal = food ? Object.values(food).flat().reduce((s,f)=>s+f.cal,0) : '';
    csv += `${d},${w.weight||''},${w.waist||''},${w.hip||''},${w.bodyFat||''},${bp.m1?.sys||''},${bp.m1?.dia||''},${bp.e1?.sys||''},${bp.e1?.dia||''},${calTotal}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'pimou-export.csv'; a.click();
  showToast('‚úì Export ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
}

function clearData() {
  if (confirm('‚ö†Ô∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ')) {
    logs = { weights: [], bp: [], food: {}, exercise: {} };
    saveData();
    showToast('üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
    updateAppUI();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// LANG HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

function toggleLangWelcome() {
  currentLang = currentLang === 'th' ? 'en' : 'th';
  localStorage.setItem('pimou_lang', currentLang);
  // Update both toggle buttons
  const wb = document.getElementById('welcome-lang-btn');
  if (wb) wb.textContent = t('lang_toggle');
  const ab = document.getElementById('lang-btn');
  if (ab) ab.textContent = t('lang_toggle');
  // Apply to welcome screen
  refreshWelcomeText();
}

/** Apply all data-i18n attributes in DOM */
function applyDataI18n() {
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    const val = t(key);
    if (val) el.textContent = val;
  });
  // Sync lang button text
  const wb = document.getElementById('welcome-lang-btn');
  if (wb) wb.textContent = t('lang_toggle');
  const ab = document.getElementById('lang-btn');
  if (ab) ab.textContent = t('lang_toggle');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load', () => {
  loadData();
  applyDataI18n();
  refreshWelcomeText();

  // Pre-fill onboarding fields from saved profile
  function fillOnboardingFields() {
    if (profile.name) document.getElementById('inp-name').value = profile.name;
    if (profile.age) document.getElementById('inp-age').value = profile.age;
    if (profile.height) document.getElementById('inp-height').value = profile.height;
    if (profile.weight) document.getElementById('inp-weight').value = profile.weight;
    if (profile.gender) { gender = profile.gender; setGender(gender); }
    if (profile.goalWeight) document.getElementById('inp-goal-weight').value = profile.goalWeight;
    if (profile.months) document.getElementById('inp-months').value = profile.months;
    if (profile.activityFactor) document.getElementById('inp-activity').value = profile.activityFactor;
    if (profile.calTarget) document.getElementById('inp-cal-target').value = profile.calTarget;
    if (profile.lineToken) document.getElementById('inp-line-token').value = profile.lineToken;
    if (profile.lineName) document.getElementById('inp-line-name').value = profile.lineName;
    updateCalcs();
  }

  // returning user ‚Üí ‡∏Ç‡πâ‡∏≤‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏•‡∏¢
  if (profile.name) {
    fillOnboardingFields();
    loadApp();
  }
  // ‡πÉ‡∏´‡∏°‡πà ‚Üí welcome screen ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
});


</script>
</body>
</html>
